import os
import telebot
import youtube_search
import yt_dlp
import time
import re
import requests
from io import BytesIO
import json
from threading import Thread
import logging
import schedule
from threading import Thread as threading_Thread
import random
import string
from datetime import datetime, timedelta
import base64

# Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

# ØªÙˆÙƒÙ† Ø§Ù„Ø¨ÙˆØª
BOT_TOKEN = "8390149006:AAFSy4v-lir3S_GrGBFKXNoVy9sR_jgn23g"
bot = telebot.TeleBot(BOT_TOKEN)

# Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¨ÙˆØª
BOT_NAME = "âŒ¯ğ— ğ—¢ğ—¨ğ—”ğ—”ğ——"
CHANNEL_LINK = "https://t.me/UPDATE_GATTOUZ"
CHANNEL_USERNAME = "UPDATE_GATTOUZ"  # Ø¨Ø¯ÙˆÙ† @
search_results = {}

# Ù…Ø¬Ù„Ø¯ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø¤Ù‚Øª Ù„Ù„Ù…Ù„ÙØ§Øª
if not os.path.exists("downloads"):
    os.makedirs("downloads")

# Ù…Ù„ÙØ§Øª Ø§Ù„ØªØ®Ø²ÙŠÙ†
ADMINS_FILE = "admins.json"
GROUP_SETTINGS_FILE = "group_settings.json"
GROUP_ROLES_FILE = "group_roles.json"
USER_DATA_FILE = "user_data.json"
CODES_FILE = "codes.json"
DEVELOPER_DATA_FILE = "developer.json"
USER_PHOTOS_FILE = "user_photos.json"
# Ù†Ù‚Ù„ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ø²Ø¡ Ø¥Ù„Ù‰ Ø£Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù„Ù Ø¨Ø¹Ø¯ ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ù…Ø¨Ø§Ø´Ø±Ø©
def send_subscription_message(chat_id, user_id):
    try:
        markup = telebot.types.InlineKeyboardMarkup()
        channel_btn = telebot.types.InlineKeyboardButton("Ø§Ø´ØªØ±Ùƒ ÙÙŠ Ø§Ù„Ù‚Ù†Ø§Ø© Ø£ÙˆÙ„Ø§Ù‹ âœ…", url=CHANNEL_LINK)
        check_btn = telebot.types.InlineKeyboardButton("ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ â™»ï¸", callback_data=f"check_sub_{user_id}")
        markup.add(channel_btn)
        markup.add(check_btn)
        
        bot.send_message(chat_id, f"ğŸ“¢ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ Ù‚Ù†Ø§ØªÙ†Ø§ Ø£ÙˆÙ„Ø§Ù‹ Ù„ØªØªÙ…ÙƒÙ† Ù…Ù† Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙˆØª:\n{CHANNEL_LINK}", reply_markup=markup)
    except Exception as e:
        logger.error(f"Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ: {e}")

# Ø«Ù… Ø¨Ø¹Ø¯Ù‡Ø§ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¶Ø¹ Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
def check_subscription(user_id):
    # Ø§Ù„Ù…Ø·ÙˆØ± ÙˆØ§Ù„Ù…Ø§Ù„Ùƒ Ù„Ø§ ÙŠØ­ØªØ§Ø¬ÙˆÙ† Ù„Ù„Ø§Ø´ØªØ±Ø§Ùƒ
    if is_owner(user_id) or is_admin(user_id):
        return True
    
    try:
        # Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ø¶Ùˆ ÙÙŠ Ø§Ù„Ù‚Ù†Ø§Ø©
        chat_member = bot.get_chat_member(f"@{CHANNEL_USERNAME}", user_id)
        
        # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ø¶Ùˆ
        if chat_member.status in ['member', 'administrator', 'creator']:
            return True
        else:
            return False
            
    except Exception as e:
        logger.error(f"Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ: {e}")
        # ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£ØŒ Ù†Ø¹ØªØ¨Ø± Ø£Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø´ØªØ±Ùƒ Ù„ØªØ¬Ù†Ø¨ Ù…Ù†Ø¹ Ø§Ù„Ø®Ø¯Ù…Ø©
        return True
# Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¢ÙŠØ§Øª Ø§Ù„Ù‚Ø±Ø¢Ù†ÙŠØ©
QURAN_VERSES = [
    "(ÙˆÙÙŠÙØ´Ù’ÙÙ ØµÙØ¯ÙÙˆØ±Ù Ù‚ÙÙˆÙ’Ù…Ù Ù…ÙØ¤Ù’Ù…ÙÙ†ÙÙŠÙ†Ù). [Ø§Ù„ØªÙˆØ¨Ø©: 14]",
    "(ÙˆÙØ¥ÙØ°ÙØ§ Ù…ÙØ±ÙØ¶Ù’ØªÙ ÙÙÙ‡ÙÙˆÙ ÙŠÙØ´Ù’ÙÙÙŠÙ†Ù). [Ø§Ù„Ø´Ø¹Ø±Ø§Ø¡: 80]",
    "(Ù‚ÙØ¯Ù’ Ø¬ÙØ§Ø¡ÙØªÙ’ÙƒÙÙ…Ù’ Ù…ÙÙˆÙ’Ø¹ÙØ¸ÙØ©ÙŒ Ù…ÙÙ†Ù’ Ø±ÙØ¨ÙÙ‘ÙƒÙÙ…Ù’ ÙˆÙØ´ÙÙÙØ§Ø¡ÙŒ Ù„ÙÙ…ÙØ§ ÙÙÙŠ Ø§Ù„ØµÙÙ‘Ø¯ÙÙˆØ±Ù). [ÙŠÙˆÙ†Ø³: 57]",
    "(ÙŠÙØ®Ù’Ø±ÙØ¬Ù Ù…ÙÙ†Ù’ Ø¨ÙØ·ÙÙˆÙ†ÙÙ‡ÙØ§ Ø´ÙØ±ÙØ§Ø¨ÙŒ Ù…ÙØ®Ù’ØªÙÙ„ÙÙÙŒ Ø£ÙÙ„Ù’ÙˆÙØ§Ù†ÙÙ‡Ù ÙÙÙŠÙ‡Ù Ø´ÙÙÙØ§Ø¡ÙŒ Ù„ÙÙ„Ù†ÙÙ‘Ø§Ø³Ù). [Ø§Ù„Ù†Ø­Ù„: 69]",
    "(ÙˆÙÙ†ÙÙ†ÙØ²ÙÙ‘Ù„Ù Ù…ÙÙ†Ù Ø§Ù„Ù’Ù‚ÙØ±Ù’Ø¢Ù†Ù Ù…ÙØ§ Ù‡ÙÙˆÙ Ø´ÙÙÙØ§Ø¡ÙŒ ÙˆÙØ±ÙØ­Ù’Ù…ÙØ©ÙŒ Ù„ÙÙ„Ù’Ù…ÙØ¤Ù’Ù…ÙÙ†ÙÙŠÙ†Ù). [Ø§Ù„Ø¥Ø³Ø±Ø§Ø¡: 82]",
    "(Ù‚ÙÙ„Ù’ Ù‡ÙÙˆÙ Ù„ÙÙ„ÙÙ‘Ø°ÙÙŠÙ†Ù Ø¢Ù…ÙÙ†ÙÙˆØ§ Ù‡ÙØ¯Ù‹Ù‰ ÙˆÙØ´ÙÙÙØ§Ø¡ÙŒ). [ÙØµÙ„Øª: 44]",
    "(Ø£ÙÙ„ÙÙ…Û¡ ÙŠÙØ£Û¡Ù†Ù Ù„ÙÙ„ÙÙ‘Ø°ÙÙŠÙ†Ù Ø¡ÙØ§Ù…ÙÙ†ÙÙˆÛ¤Ø§ÛŸ Ø£ÙÙ† ØªÙØ®Û¡Ø´ÙØ¹Ù Ù‚ÙÙ„ÙÙˆØ¨ÙÙ‡ÙÙ…Û¡ Ù„ÙØ°ÙÙƒÛ¡Ø±Ù Ù±Ù„Ù„ÙÙ‘Ù‡Ù ÙˆÙÙ…ÙØ§ Ù†ÙØ²ÙÙ„Ù Ù…ÙÙ†Ù Ù±Ù„Û¡Ø­ÙÙ‚ÙÙ‘ ÙˆÙÙ„ÙØ§ ÙŠÙÙƒÙÙˆÙ†ÙÙˆØ§ÛŸ ÙƒÙÙ±Ù„ÙÙ‘Ø°ÙÙŠÙ†Ù Ø£ÙÙˆØªÙÙˆØ§ÛŸ Ù±Ù„Û¡ÙƒÙØªÙÙ€Ù°Ø¨Ù Ù…ÙÙ† Ù‚ÙØ¨Û¡Ù„Ù ÙÙØ·ÙØ§Ù„Ù Ø¹ÙÙ„ÙÙŠÛ¡Ù‡ÙÙ…Ù Ù±Ù„Û¡Ø£ÙÙ…ÙØ¯Ù ÙÙÙ‚ÙØ³ÙØªÛ¡ Ù‚ÙÙ„ÙÙˆØ¨ÙÙ‡ÙÙ…Û¡Û– ÙˆÙÙƒÙØ«ÙÙŠØ±à£± Ù…ÙÙ‘Ù†Û¡Ù‡ÙÙ…Û¡ ÙÙÙ€Ù°Ø³ÙÙ‚ÙÙˆÙ†Ù). [Ø§Ù„Ø­Ø¯ÙŠØ¯: 16]",
    "(ÙŠÙÙˆÛ¡Ù…Ù ÙŠÙÙ‚ÙÙˆÙ…Ù Ù±Ù„Û¡Ù…ÙÙ†ÙÙ€Ù°ÙÙÙ‚ÙÙˆÙ†Ù ÙˆÙÙ±Ù„Û¡Ù…ÙÙ†ÙÙ€Ù°ÙÙÙ‚ÙÙ€Ù°ØªÙ Ù„ÙÙ„ÙÙ‘Ø°ÙÙŠÙ†Ù Ø¡ÙØ¢Ù…ÙÙ†ÙÙˆØ§ÛŸ Ù±Ù†Ø¸ÙØ±ÙÙˆÙ†ÙØ§ Ù†ÙÙ‚Û¡ØªÙØ¨ÙØ³Û¡ Ù…ÙÙ† Ù†ÙÙ‘ÙˆØ±ÙÙƒÙÙ…Û¡ Ù‚ÙÙŠÙ„Ù Ù±Ø±Û¡Ø¬ÙØ¹ÙÙˆØ§ÛŸ ÙˆÙØ±ÙØ§Û¤Ø¡ÙÙƒÙÙ…Û¡ ÙÙÙ±Ù„Û¡ØªÙÙ…ÙØ³ÙÙˆØ§ÛŸ Ù†ÙÙˆØ±à£°Ø§Û– ÙÙØ¶ÙØ±ÙØ¨Ù Ø¨ÙÙŠÛ¡Ù†ÙÙ‡ÙÙ… Ø¨ÙØ³ÙÙˆØ±à£² Ù„ÙÙ‘Ù‡ÙÛ¥ Ø¨ÙØ§Ø·ÙÙ†ÙÙ‡ÙÛ¥ ÙÙÙŠÙ‡Ù Ù±Ù„Ø±ÙÙ‘Ø­Û¡Ù…ÙØ©Ù ÙˆÙØ¸ÙÙ€Ù°Ù‡ÙØ±ÙÙ‡ÙÛ¥ Ù…ÙÙ† Ù‚ÙØ¨ÙÙ„ÙÙ‡Ù Ù±Ù„Û¡Ø¹ÙØ°ÙØ§Ø¨Ù ÙŠÙÙ†ÙØ§Ø¯ÙÙˆÙ†ÙÙ‡ÙÙ…Û¡ Ø£ÙÙ„ÙÙ…Û¡ Ù†ÙÙƒÙÙ† Ù…ÙÙ‘Ø¹ÙÙƒÙÙ…Û¡Û– Ù‚ÙØ§Ù„ÙÙˆØ§ÛŸ Ø¨ÙÙ„ÙÙ‰Ù° ÙˆÙÙ„ÙÙ€Ù°ÙƒÙÙ†ÙÙ‘ÙƒÙÙ…Û¡ ÙÙØªÙÙ†ØªÙÙ…Û¡ Ø£ÙÙ†ÙÙØ³ÙÙƒÙÙ…Û¡ ÙˆÙØªÙØ±ÙØ¨ÙÙ‘ØµÛ¡ØªÙÙ…Û¡ ÙˆÙÙ±Ø±Û¡ØªÙØ¨Û¡ØªÙÙ…Û¡ ÙˆÙØºÙØ±ÙÙ‘ØªÛ¡ÙƒÙÙ…Ù Ù±Ù„Û¡Ø£ÙÙ…ÙØ§Ù†ÙÙŠÙÙ‘ Ø­ÙØªÙÙ‘Ù‰Ù° Ø¬ÙØ§Û¤Ø¡Ù Ø£ÙÙ…Û¡Ø±Ù Ù±Ù„Ù„ÙÙ‘Ù‡Ù ÙˆÙØºÙØ±ÙÙ‘ÙƒÙÙ… Ø¨ÙÙ±Ù„Ù„ÙÙ‘Ù‡Ù Ù±Ù„Û¡ØºÙØ±ÙÙˆØ±Ù). [Ø§Ù„Ø­Ø¯ÙŠØ¯: 13-14]",
    "(Ø¥ÙÙ†ÙÙ‘ Ù±Ù„Û¡Ù…ÙØµÙÙ‘Ø¯ÙÙ‘Ù‚ÙÙŠÙ†Ù ÙˆÙÙ±Ù„Û¡Ù…ÙØµÙÙ‘Ø¯ÙÙ‘Ù‚ÙÙ€Ù°ØªÙ ÙˆÙØ£ÙÙ‚Û¡Ø±ÙØ¶ÙÙˆØ§ÛŸ Ù±Ù„Ù„ÙÙ‘Ù‡Ù Ù‚ÙØ±Û¡Ø¶Ù‹Ø§ Ø­ÙØ³ÙÙ†à£°Ø§ ÙŠÙØ¶ÙÙ€Ù°Ø¹ÙÙÙ Ù„ÙÙ‡ÙÙ…Û¡ ÙˆÙÙ„ÙÙ‡ÙÙ…Û¡ Ø£ÙØ¬Û¡Ø±à£± ÙƒÙØ±ÙÙŠÙ…à£±). [Ø§Ù„Ø­Ø¯ÙŠØ¯: 18]",
    "(ÙˆÙÙ±Ø³Û¡ØªÙØ¹ÙÙŠÙ†ÙÙˆØ§ÛŸ Ø¨ÙÙ±Ù„ØµÙÙ‘Ø¨Û¡Ø±Ù ÙˆÙÙ±Ù„ØµÙÙ‘Ù„ÙÙˆÙ°Ø©ÙÛš ÙˆÙØ¥ÙÙ†ÙÙ‘Ù‡ÙØ§ Ù„ÙÙƒÙØ¨ÙÙŠØ±ÙØ©ÙŒ Ø¥ÙÙ„ÙÙ‘Ø§ Ø¹ÙÙ„ÙÙ‰ Ù±Ù„Û¡Ø®ÙÙ€Ù°Ø´ÙØ¹ÙÙŠÙ†Ù). [Ø§Ù„Ø¨Ù‚Ø±Ø©: 45]",
    "(ÙˆÙÙ±ØªÙÙ‘Ù‚ÙÙˆØ§ÛŸ ÙŠÙÙˆÛ¡Ù…à£°Ø§ Ù„ÙÙ‘Ø§ ØªÙØ¬Û¡Ø²ÙÙŠ Ù†ÙÙÛ¡Ø³ÙŒ Ø¹ÙÙ† Ù†ÙÙ‘ÙÙ’Ø³à£² Ø´ÙÙŠÛ¡Ù€Ù”à£°Ø§ ÙˆÙÙ„ÙØ§ ÙŠÙÙ‚Û¡Ø¨ÙÙ„Ù Ù…ÙÙ†Û¡Ù‡ÙØ§ Ø´ÙÙÙÙ€Ù°Ø¹ÙØ©à£± ÙˆÙÙ„ÙØ§ ÙŠÙØ¤Û¡Ø®ÙØ°Ù Ù…ÙÙ†Û¡Ù‡ÙØ§ Ø¹ÙØ¯Û¡Ù„à£± ÙˆÙÙ„ÙØ§ Ù‡ÙÙ…Û¡ ÙŠÙÙ†ØµÙØ±ÙÙˆÙ†Ù). [Ø§Ù„Ø¨Ù‚Ø±Ø©: 48]",
    "(Ø¥ÙÙ†ÙÙ‘ Ù±Ù„ÙÙ‘Ø°ÙÙŠÙ†Ù Ø¡ÙØ¢Ù…ÙÙ†ÙÙˆØ§ÛŸ ÙˆÙÙ±Ù„ÙÙ‘ï¿½ÙÙŠÙ†Ù Ù‡ÙØ§Ø¯ÙÙˆØ§ÛŸ ÙˆÙÙ±Ù„Ù†ÙÙ‘ØµÙÙ€Ù°Ø±ÙÙ‰Ù° ÙˆÙÙ±Ù„ØµÙÙ‘Ù€Ù°Ø¨ÙÙ€Ù”ÙŠÙ†Ù Ù…ÙÙ†Û¡ Ø¡ÙØ¢Ù…ÙÙ†Ù Ø¨ÙÙ±Ù„Ù„ÙÙ‘Ù‡Ù ÙˆÙÙ±Ù„Û¡ÙŠÙÙˆÛ¡Ù…Ù Ù±Ù„Û¡Ù€ÙÙ”Ø§Ø®ÙØ±Ù ÙˆÙØ¹ÙÙ…ÙÙ„Ù ØµÙÙ€Ù°Ù„ÙØ­à£°Ø§ ÙÙÙ„ÙÙ‡ÙÙ…Û¡ Ø£ÙØ¬Û¡Ø±ÙÙ‡ÙÙ…Û¡ Ø¹ÙÙ†Ø¯Ù Ø±ÙØ¨ÙÙ‘Ù‡ÙÙ…Û¡ ÙˆÙÙ„ÙØ§ Ø®ÙÙˆÛ¡ÙÙŒ Ø¹ÙÙ„ÙÙŠÛ¡Ù‡ÙÙ…Û¡ ÙˆÙÙ„ÙØ§ Ù‡ÙÙ…Û¡ ÙŠÙØ­Û¡Ø²ÙÙ†ÙÙˆÙ†Ù). [Ø§Ù„Ø¨Ù‚Ø±Ø©: 62]",
    "(Ù±Ù„ÙÙ‘Ø°ÙÙŠÙ†Ù Ø¥ÙØ°ÙØ§Û¤ Ø£ÙØµÙÙ€Ù°Ø¨ÙØªÛ¡Ù‡ÙÙ… Ù…ÙÙ‘ØµÙÙŠØ¨ÙØ©à£± Ù‚ÙØ§Ù„ÙÙˆÛ¤Ø§ÛŸ Ø¥ÙÙ†ÙÙ‘Ø§ Ù„ÙÙ„ÙÙ‘Ù‡Ù ÙˆÙØ¥ÙÙ†ÙÙ‘Ø§Û¤ Ø¥ÙÙ„ÙÙŠÛ¡Ù‡Ù Ø±Ùâ€Šâ Ù°Ø¬ÙØ¹ÙÙˆÙ†Ù). [Ø§Ù„Ø¨Ù‚Ø±Ø©: 156]",
    "(Ø±ÙÙ‘Ø¨ÙÙ‘ Ù±ØºÛ¡ÙÙØ±Û¡ Ù„ÙÙŠ ÙˆÙÙ„ÙÙˆÙâ€Šâ Ù°Ù„ÙØ¯ÙÙŠÙÙ‘ ÙˆÙÙ„ÙÙ…ÙÙ† Ø¯ÙØ®ÙÙ„Ù Ø¨ÙÙŠÛ¡ØªÙÙŠÙ Ù…ÙØ¤Û¡Ù…ÙÙ†à£°Ø§ ÙˆÙÙ„ÙÙ„Û¡Ù…ÙØ¤Û¡Ù…ÙÙ†ÙÙŠÙ†Ù ÙˆÙÙ±Ù„Û¡Ù…ÙØ¤Û¡Ù…ÙÙ†ÙÙ€Ù°ØªÙÛ– ÙˆÙÙ„ÙØ§ ØªÙØ²ÙØ¯Ù Ù±Ù„Ø¸ÙÙ‘Ù€Ù°Ù„ÙÙ…ÙÙŠÙ†Ù Ø¥ÙÙ„ÙÙ‘Ø§ ØªÙØ¨ÙØ§Ø±ÙÛ¢Ø§). [Ù†ÙˆØ­: 28]",
    "(ÙˆÙØ£ÙÙ†ÙÙ‘ Ù±Ù„Û¡Ù…ÙØ³ÙÙ€Ù°Ø¬ÙØ¯Ù Ù„ÙÙ„ÙÙ‘Ù‡Ù ÙÙÙ„ÙØ§ ØªÙØ¯Û¡Ø¹ÙÙˆØ§ÛŸ Ù…ÙØ¹Ù Ù±Ù„Ù„ÙÙ‘Ù‡Ù Ø£ÙØ­ÙØ¯à£°Ø§ ÙˆÙØ£ÙÙ†ÙÙ‘Ù‡ÙÛ¥ Ù„ÙÙ…ÙÙ‘Ø§ Ù‚ÙØ§Ù…Ù Ø¹ÙØ¨Û¡Ø¯Ù Ù±Ù„Ù„ÙÙ‘Ù‡Ù ÙŠÙØ¯Û¡Ø¹ÙÙˆÙ‡Ù ÙƒÙØ§Ø¯ÙÙˆØ§ÛŸ ÙŠÙÙƒÙÙˆÙ†ÙÙˆÙ†Ù Ø¹ÙÙ„ÙÙŠÛ¡Ù‡Ù Ù„ÙØ¨ÙØ¯à£°Ø§). [Ø§Ù„Ø¬Ù†: 18]",
    "(ÙˆÙÙ±Ø°Û¡ÙƒÙØ±Ù Ù±Ø³Û¡Ù…Ù Ø±ÙØ¨ÙÙ‘ÙƒÙ ÙˆÙØªÙØ¨ÙØªÙÙ‘Ù„Û¡ Ø¥ÙÙ„ÙÙŠÛ¡Ù‡Ù ØªÙØ¨Û¡ØªÙÙŠÙ„à£°Ø§ Ø±ÙÙ‘Ø¨ÙÙ‘ Ù±Ù„Û¡Ù…ÙØ´Û¡Ø±ÙÙ‚Ù ÙˆÙÙ±Ù„Û¡Ù…ÙØºÛ¡Ø±ÙØ¨Ù Ù„ÙØ§Û¤ Ø¥ÙÙ„ÙÙ€Ù°Ù‡Ù Ø¥ÙÙ„ÙÙ‘Ø§ Ù‡ÙÙˆÙ ÙÙÙ±ØªÙÙ‘Ø®ÙØ°Û¡Ù‡Ù ÙˆÙÙƒÙÙŠÙ„à£°Ø§ ÙˆÙÙ±ØµÛ¡Ø¨ÙØ±Û¡ Ø¹ÙÙ„ÙÙ‰Ù° Ù…ÙØ§ ÙŠÙÙ‚ÙÙˆÙ„ÙÙˆÙ†Ù ÙˆÙÙ±Ù‡Û¡Ø¬ÙØ±Û¡Ù‡ÙÙ…Û¡ Ù‡ÙØ¬Û¡Ø±à£°Ø§ Ø¬ÙÙ…ÙÙŠÙ„à£°Ø§). [Ø§Ù„Ù…Ø²Ù…Ù„: 8-10]"
]

verse_index = 0
send_verses_enabled = True

# Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù‡Ù†
JOBS = {
    "Ø·Ø¨ÙŠØ¨": {"min_salary": 5000, "max_salary": 15000, "emoji": "ğŸ‘¨â€âš•ï¸"},
    "Ù…Ù‡Ù†Ø¯Ø³": {"min_salary": 4500, "max_salary": 12000, "emoji": "ğŸ‘¨â€ğŸ’»"},
    "Ù…Ø¹Ù„Ù…": {"min_salary": 3000, "max_salary": 8000, "emoji": "ğŸ‘¨â€ğŸ«"},
    "ØªØ§Ø¬Ø±": {"min_salary": 4000, "max_salary": 20000, "emoji": "ğŸ‘¨â€ğŸ’¼"},
    "Ø³Ø§Ø¦Ù‚": {"min_salary": 2000, "max_salary": 5000, "emoji": "ğŸš—"},
    "Ù†Ø¬Ø§Ø±": {"min_salary": 2500, "max_salary": 6000, "emoji": "ğŸ”¨"},
    "Ø®Ø¨Ø§Ø²": {"min_salary": 2000, "max_salary": 4500, "emoji": "ğŸ"},
    "Ù…Ø²Ø§Ø±Ø¹": {"min_salary": 1500, "max_salary": 4000, "emoji": "ğŸ‘¨â€ğŸŒ¾"},
    "Ø´Ø±Ø·ÙŠ": {"min_salary": 3500, "max_salary": 9000, "emoji": "ğŸ‘®"},
    "Ù…Ø­Ø§Ø³Ø¨": {"min_salary": 3000, "max_salary": 7000, "emoji": "ğŸ“Š"},
    "Ù…Ø¨Ø±Ù…Ø¬": {"min_salary": 4000, "max_salary": 15000, "emoji": "ğŸ’»"},
    "Ø³Ø¨Ø§Ùƒ": {"min_salary": 2500, "max_salary": 6000, "emoji": "ğŸ”§"},
    "ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ": {"min_salary": 2500, "max_salary": 6000, "emoji": "âš¡"},
    "Ù†Ø§Ø¯Ù„": {"min_salary": 1500, "max_salary": 3500, "emoji": "ğŸ½ï¸"},
    "Ø­Ù„Ø§Ù‚": {"min_salary": 2000, "max_salary": 5000, "emoji": "âœ‚ï¸"}
}

# ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
def load_data(filename, default={}):
    try:
        if os.path.exists(filename):
            with open(filename, 'r', encoding='utf-8') as f:
                return json.load(f)
    except:
        pass
    return default

def save_data(filename, data):
    with open(filename, 'w', encoding='utf-8') as f:
        json.dump(data, f, ensure_ascii=False, indent=4)

# ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
admins_data = load_data(ADMINS_FILE, {"owner": 5545019702, "admins": [5545019702]})
group_settings = load_data(GROUP_SETTINGS_FILE)
group_roles = load_data(GROUP_ROLES_FILE)
user_data = load_data(USER_DATA_FILE)
codes_data = load_data(CODES_FILE)
developer_data = load_data(DEVELOPER_DATA_FILE, {"photo_id": None, "photo_url": None})
user_photos = load_data(USER_PHOTOS_FILE)

# ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©
def is_owner(user_id):
    return admins_data.get("owner") == user_id

def is_admin(user_id):
    return user_id in admins_data.get("admins", []) or is_owner(user_id)

def is_group_chat(chat_id):
    try:
        chat = bot.get_chat(chat_id)
        return chat.type in ['group', 'supergroup']
    except:
        return False

def get_user_role(chat_id, user_id):
    chat_id_str = str(chat_id)
    user_id_str = str(user_id)
    
    if chat_id_str in group_roles:
        if user_id_str in group_roles[chat_id_str].get('admins', []):
            return 'admin'
        elif user_id_str in group_roles[chat_id_str].get('vips', []):
            return 'vip'
    
    try:
        member = bot.get_chat_member(chat_id, user_id)
        if member.status in ['administrator', 'creator']:
            return 'group_admin'
    except:
        pass
    
    return 'member'

def can_manage_users(chat_id, user_id):
    role = get_user_role(chat_id, user_id)
    return role in ['admin', 'group_admin'] or is_admin(user_id)

def can_use_bot_commands(chat_id, user_id):
    role = get_user_role(chat_id, user_id)
    return role in ['admin', 'vip', 'group_admin'] or is_admin(user_id)

def get_user_data(user_id):
    user_id_str = str(user_id)
    if user_id_str not in user_data:
        user_data[user_id_str] = {
            "money": 1000,
            "job": None,
            "last_salary": None,
            "married_to": None,
            "last_daily": None,
            "bank_account": None,
            "messages_count": 0,
            "rob_count": 0,
            "rob_success": 0,
            "created_at": datetime.now().strftime("%Y-%m-%d %H:%M:%S")
        }
        save_data(USER_DATA_FILE, user_data)
    return user_data[user_id_str]

def update_user_data(user_id, data):
    user_id_str = str(user_id)
    user_data[user_id_str] = data
    save_data(USER_DATA_FILE, user_data)

# Ø­Ø³Ø§Ø¨ ØªØ§Ø±ÙŠØ® Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­
def get_account_creation_date(user_id):
    user_info = get_user_data(user_id)
    
    if "created_at" in user_info:
        return user_info["created_at"]
    else:
        # Ø­Ø³Ø§Ø¨ ØªÙ‚Ø±ÙŠØ¨ÙŠ Ù…Ù† ID Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ø§Ù„ØªØ§Ø±ÙŠØ® Ù…Ø­ÙÙˆØ¸Ø§Ù‹)
        timestamp = (user_id - 1000000000000) // 1000000
        if timestamp > 0:
            try:
                creation_date = datetime.fromtimestamp(timestamp).strftime("%Y-%m-%d %H:%M:%S")
                user_info["created_at"] = creation_date
                update_user_data(user_id, user_info)
                return creation_date
            except:
                return "2023-01-01 00:00:00"
        else:
            return "2023-01-01 00:00:00"

# Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØµÙˆØ±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
def get_user_photo(user_id):
    user_id_str = str(user_id)
    if user_id_str in user_photos:
        return user_photos[user_id_str]
    return None

# Ø­ÙØ¸ ØµÙˆØ±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
def save_user_photo(user_id, photo_id, photo_url):
    user_id_str = str(user_id)
    user_photos[user_id_str] = {
        "photo_id": photo_id,
        "photo_url": photo_url,
        "updated_at": datetime.now().strftime("%Y-%m-%d %H:%M:%S")
    }
    save_data(USER_PHOTOS_FILE, user_photos)

# ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ÙŠÙˆØªÙŠÙˆØ¨
def download_audio_method1(url, video_id):
    try:
        ydl_opts = {
            'format': 'bestaudio[ext=m4a]/bestaudio',
            'outtmpl': f"downloads/{video_id}.%(ext)s",
            'quiet': True,
            'no_warnings': True,
        }
        with yt_dlp.YoutubeDL(ydl_opts) as ydl:
            ydl.download([url])
        for ext in ['m4a', 'webm', 'mp3']:
            if os.path.exists(f"downloads/{video_id}.{ext}"):
                return f"downloads/{video_id}.{ext}"
        return None
    except Exception as e:
        logger.error(f"Download error: {e}")
        return None

# ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø¢ÙŠØ§Øª Ø§Ù„Ù‚Ø±Ø¢Ù†ÙŠØ©
def send_quran_verses():
    global verse_index
    if not send_verses_enabled:
        return
    try:
        for chat_id_str in group_settings.keys():
            try:
                chat_id = int(chat_id_str)
                if group_settings[chat_id_str].get('quran', True):
                    verse = QURAN_VERSES[verse_index]
                    bot.send_message(chat_id, f"ğŸ“– Ø¢ÙŠØ© Ù‚Ø±Ø¢Ù†ÙŠØ©:\n\n{verse}")
            except Exception as e:
                logger.error(f"Error sending verse: {e}")
        verse_index = (verse_index + 1) % len(QURAN_VERSES)
    except Exception as e:
        logger.error(f"Error in send_quran_verses: {e}")

def schedule_verses():
    schedule.every(15).minutes.do(send_quran_verses)
    while True:
        schedule.run_pending()
        time.sleep(1)

verse_thread = threading_Thread(target=schedule_verses)
verse_thread.daemon = True
verse_thread.start()

# Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ Ø§Ù„Ù‚Ù†Ø§Ø©
def check_subscription(user_id):
    # Ø§Ù„Ù…Ø·ÙˆØ± ÙˆØ§Ù„Ù…Ø§Ù„Ùƒ Ù„Ø§ ÙŠØ­ØªØ§Ø¬ÙˆÙ† Ù„Ù„Ø§Ø´ØªØ±Ø§Ùƒ
    if is_owner(user_id) or is_admin(user_id):
        return True
    
    try:
        # Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ø¶Ùˆ ÙÙŠ Ø§Ù„Ù‚Ù†Ø§Ø©
        chat_member = bot.get_chat_member(f"@{CHANNEL_USERNAME}", user_id)
        
        # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ø¶Ùˆ
        if chat_member.status in ['member', 'administrator', 'creator']:
            return True
        else:
            return False
            
    except Exception as e:
        logger.error(f"Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ: {e}")
        # ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£ØŒ Ù†Ø¹ØªØ¨Ø± Ø£Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø´ØªØ±Ùƒ Ù„ØªØ¬Ù†Ø¨ Ù…Ù†Ø¹ Ø§Ù„Ø®Ø¯Ù…Ø©
        return True

# Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø±Ø¯ÙˆØ¯ Ø¹Ù„Ù‰ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ£ÙƒÙŠØ¯
@bot.callback_query_handler(func=lambda call: call.data.startswith('check_sub_'))
def handle_check_subscription(call):
    user_id = int(call.data.split('_')[-1])
    if check_subscription(user_id):
        bot.answer_callback_query(call.id, "âœ… ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙˆØª Ø§Ù„Ø¢Ù†!")
        try:
            bot.delete_message(call.message.chat.id, call.message.message_id)
        except:
            pass
    else:
        bot.answer_callback_query(call.id, "âŒ Ù„Ù… ØªØ´ØªØ±Ùƒ Ø¨Ø¹Ø¯ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø£ÙˆÙ„Ø§Ù‹ Ø«Ù… Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰!")
# ÙˆØ¸Ø§Ø¦Ù Ø®Ø§ØµØ© Ø¨Ø§Ù„Ù…Ø·ÙˆØ±
def get_developer_photo():
    """Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØµÙˆØ±Ø© Ø§Ù„Ù…Ø·ÙˆØ± ÙˆØªØ­Ø¯ÙŠØ«Ù‡Ø§"""
    try:
        # Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø·ÙˆØ±
        dev_user = bot.get_chat(5545019702)
        
        if dev_user.photo:
            # Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø£ÙƒØ¨Ø± Ø­Ø¬Ù… Ù„Ù„ØµÙˆØ±Ø©
            file_info = bot.get_file(dev_user.photo.big_file_id)
            downloaded_file = bot.download_file(file_info.file_path)
            
            # Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø© Ù…Ø¤Ù‚ØªØ§Ù‹
            with open("developer_photo.jpg", "wb") as photo_file:
                photo_file.write(downloaded_file)
            
            # Ø­ÙØ¸ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØµÙˆØ±Ø©
            developer_data["photo_id"] = dev_user.photo.big_file_id
            developer_data["photo_url"] = f"https://api.telegram.org/file/bot{BOT_TOKEN}/{file_info.file_path}"
            save_data(DEVELOPER_DATA_FILE, developer_data)
            
            return downloaded_file
    except Exception as e:
        logger.error(f"Error getting developer photo: {e}")
    
    return None

# --- Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ---
@bot.message_handler(commands=['start', 'help'])
def send_welcome(message):
    user_id = message.from_user.id
    
    # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
    if not check_subscription(user_id):
        send_subscription_message(message.chat.id, user_id)
        return
        
    if is_group_chat(message.chat.id):
        role = get_user_role(message.chat.id, message.from_user.id)
        role_text = {
            'admin': 'Ù…Ø´Ø±Ù Ø§Ù„Ø¨ÙˆØª', 'vip': 'Ù…Ù…ÙŠØ²',
            'group_admin': 'Ù…Ø´Ø±Ù Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©', 'member': 'Ø¹Ø¶Ùˆ'
        }.get(role, 'Ø¹Ø¶Ùˆ')
        
        text = f"Ù…Ø±Ø­Ø¨Ù‹Ø§! Ø£Ù†Ø§ Ø¨ÙˆØª Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©. Ø±ØªØ¨ØªÙƒ: {role_text}\n\n"
        text += "Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…ØªØ§Ø­Ø©:\n"
        text += "Ø§Ù„Ø§Ø¹Ø¯Ø§Ø¯Ø§Øª - Ù„Ø¥Ø¸Ù‡Ø§Ø± Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø­Ù…Ø§ÙŠØ©\n"
        
        if can_manage_users(message.chat.id, message.from_user.id):
            text += "ÙƒØªÙ…/Ø­Ø¸Ø±/ÙÙƒ ÙƒØªÙ…/ÙÙƒ Ø­Ø¸Ø± - Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ (Ø¨Ø§Ù„Ø±Ø¯)\n"
            text += "Ø±ÙØ¹ Ù…Ø´Ø±Ù/ØªÙ†Ø²ÙŠÙ„ Ù…Ø´Ø±Ù/Ø±ÙØ¹ Ù…Ù…ÙŠØ²/ØªÙ†Ø²ÙŠÙ„ Ù…Ù…ÙŠØ² - Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¯ÙˆØ§Ø± (Ø¨Ø§Ù„Ø±Ø¯)\n"
        
        bot.reply_to(message, text)
    else:
        welcome_text = f"""*â–¶ï¸ | Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø¨ÙˆØª {BOT_NAME}*\n\n
*â—ˆ | Ù„Ù„Ø¨Ø­Ø« Ø¹Ù† ÙÙŠØ¯ÙŠÙˆ:*
`ÙŠÙˆØª` + ÙƒÙ„Ù…Ø© Ø§Ù„Ø¨Ø­Ø«

*â—ˆ | Ù…Ø«Ø§Ù„:* `ÙŠÙˆØª Ø£ØºÙ†ÙŠØ© Ø¬Ù…ÙŠÙ„Ø©`

*â—ˆ | Ø§Ù„Ø¨ÙˆØª ÙŠØ¯Ø¹Ù… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø£ÙŠØ¶Ø§Ù‹*"""
        
        markup = telebot.types.InlineKeyboardMarkup()
        add_to_group_btn = telebot.types.InlineKeyboardButton("Ø§Ø¶ÙÙ†ÙŠ ÙÙŠ Ù…Ø¬Ù…ÙˆØ¹ØªÙƒ âœ…", url="https://t.me/Kfkfkhjjfkbot?startgroup=true")
        
        # Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ø§Ù„Ù…Ø·ÙˆØ± Ø§Ù„Ø´ÙØ§Ù Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù‡Ùˆ Ø§Ù„Ù…Ø·ÙˆØ±
        if user_id == 5545019702:
            dev_btn = telebot.types.InlineKeyboardButton("ğŸ”³", url="tg://user?id=5545019702")
            markup.add(add_to_group_btn, dev_btn)
        else:
            markup.add(add_to_group_btn)
        
        bot.reply_to(message, welcome_text, reply_markup=markup, parse_mode="Markdown")

# --- Ø£ÙˆØ§Ù…Ø± Ø§Ù„ØªØ³Ù„ÙŠØ© ---
@bot.message_handler(func=lambda m: m.text and m.text.lower() in ['ÙƒØª', 'Ù†Ø±Ø¯', 'Ø²ÙˆØ¬Ù†ÙŠ', 'Ø§Ø­Ø¨Ùƒ', 'Ø¨ÙˆØ³Ù‡', 'Ø¨ÙˆØ³Ø©', 'ØªÙØ§ØµÙŠÙ„', 'Ù‡ÙŠÙ†Ù‡', 'Ù‡ÙŠÙ†Ù‡ÙŠ', 'Ù‡ÙŠÙ†Ù‡Ø§', 'Ø«Ø«'])
def entertainment_commands(message):
    if not is_group_chat(message.chat.id):
        return
        
    # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
    if not check_subscription(message.from_user.id):
        send_subscription_message(message.chat.id, message.from_user.id)
        return
        
    text = message.text.lower()
    user_name = message.from_user.first_name
            
    if text == 'ÙƒØª':
        replies = [f"ÙˆÙŠÙ†Ù‡ Ø§Ù„ÙƒØª {user_name}ØŸ ğŸ¤”", f"Ø§Ù„ÙƒØª Ù…Ø¹ {user_name} Ø¶Ø§Ø¹! ğŸ˜…"]
        bot.reply_to(message, random.choice(replies))
        
    elif text == 'Ù†Ø±Ø¯':
        dice_value = random.randint(1, 6)
        bot.reply_to(message, f"Ø·Ù„Ø¹ Ù„Ùƒ {dice_value} ğŸ²")
        
    elif text == 'Ø²ÙˆØ¬Ù†ÙŠ':
        if message.reply_to_message:
            target_name = message.reply_to_message.from_user.first_name
            bot.reply_to(message, f"Ù…Ø¨Ø±ÙˆÙƒ! {user_name} ØªØ²ÙˆØ¬ {target_name} ğŸ‘°â€â™€ï¸ğŸ¤µâ€â™‚ï¸")
        else:
            bot.reply_to(message, f"Ù…ÙŠÙ† ØªØ¨ÙŠ ØªØªØ²ÙˆØ¬ ÙŠØ§ {user_name}ØŸ ğŸ˜…")
        
    elif text == 'Ø§Ø­Ø¨Ùƒ':
        if message.reply_to_message:
            target_name = message.reply_to_message.from_user.first_name
            bot.reply_to(message, f"ÙˆØ§Ùˆ! {user_name} ÙŠØ­Ø¨ {target_name} ğŸ˜")
        else:
            bot.reply_to(message, f"Ø§Ù†Ø§ ÙƒÙ…Ø§Ù† Ø¨Ø­Ø¨Ùƒ ÙŠØ§ {user_name} ğŸ˜˜")
        
    elif text in ['Ø¨ÙˆØ³Ù‡', 'Ø¨ÙˆØ³Ø©']:
        if message.reply_to_message:
            target_name = message.reply_to_message.from_user.first_name
            bot.reply_to(message, f"ğŸ’‹ {user_name} Ø¨ÙˆØ³ {target_name}")
        else:
            bot.reply_to(message, f"ğŸ’‹ Ø®Ø¯ Ø¨ÙˆØ³Ø© Ù…Ù†ÙŠ ÙŠØ§ {user_name}")
        
    elif text == 'ØªÙØ§ØµÙŠÙ„':
        if message.reply_to_message:
            target = message.reply_to_message.from_user
            creation_date = get_account_creation_date(target.id)
            user_info = get_user_data(target.id)
            bot.reply_to(message, f"ğŸ‘¤ Ø§Ù„Ø§Ø³Ù…: {target.first_name}\nğŸ†” Ø§Ù„Ø§ÙŠØ¯ÙŠ: {target.id}\nğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†Ø´Ø§Ø¡: {creation_date}\nğŸ’¬ Ø¹Ø¯Ø¯ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„: {user_info.get('messages_count', 0)}")
        else:
            creation_date = get_account_creation_date(message.from_user.id)
            user_info = get_user_data(message.from_user.id)
            bot.reply_to(message, f"ğŸ‘¤ Ø§Ù„Ø§Ø³Ù…: {user_name}\nğŸ†” Ø§Ù„Ø§ÙŠØ¯ÙŠ: {message.from_user.id}\nğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†Ø´Ø§Ø¡: {creation_date}\nğŸ’¬ Ø¹Ø¯Ø¯ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„: {user_info.get('messages_count', 0)}")
        
    elif text in ['Ù‡ÙŠÙ†Ù‡', 'Ù‡ÙŠÙ†Ù‡ÙŠ', 'Ù‡ÙŠÙ†Ù‡Ø§']:
        if message.reply_to_message:
            target_name = message.reply_to_message.from_user.first_name
            bot.reply_to(message, f"ğŸ˜  {user_name} ÙŠÙ‡ÙŠÙ† {target_name}")
        else:
            bot.reply_to(message, f"ğŸ˜  Ù…ÙŠÙ† ØªØ¨ÙŠ ØªÙ‡ÙŠÙ†Ù‡ ÙŠØ§ {user_name}ï¼Ÿ")
        
    elif text == 'Ø«Ø«':
        try:
            members = ['Ø£Ø­Ù…Ø¯', 'ÙØ§Ø·Ù…Ø©', 'Ù…Ø­Ù…Ø¯', 'Ø®Ø¯ÙŠØ¬Ø©', 'ÙŠÙˆØ³Ù', user_name]
            if message.reply_to_message:
                members.append(message.reply_to_message.from_user.first_name)
            member1, member2 = random.sample(members, 2)
            bot.reply_to(message, f"ğŸ’• {member1} Ùˆ {member2} ÙŠØªØ«Ø§Ù‚Ù„ÙˆÙ†!")
        except:
            bot.reply_to(message, "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£!")

# --- Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø­Ù…Ø§ÙŠØ© ---
lock_commands = {
    'Ù‚ÙÙ„ Ø§Ù„Ù…Ù„ØµÙ‚Ø§Øª': 'stickers', 'ÙØªØ­ Ø§Ù„Ù…Ù„ØµÙ‚Ø§Øª': 'stickers',
    'Ù‚ÙÙ„ Ø§Ù„ØµÙˆØ±': 'photos', 'ÙØªØ­ Ø§Ù„ØµÙˆØ±': 'photos',
    'Ù‚ÙÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ': 'videos', 'ÙØªØ­ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ': 'videos',
    'Ù‚ÙÙ„ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©': 'texts', 'ÙØªØ­ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©': 'texts',
    'Ù‚ÙÙ„ Ø§Ù„ØµÙˆØªÙŠØ§Øª': 'audios', 'ÙØªØ­ Ø§Ù„ØµÙˆØªÙŠØ§Øª': 'audios',
    'Ù‚ÙÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª': 'documents', 'ÙØªØ­ Ø§Ù„Ù…Ù„ÙØ§Øª': 'documents',
    'Ù‚ÙÙ„ Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆØ¬ÙŠÙ‡': 'forwards', 'ÙØªØ­ Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆØ¬ÙŠÙ‡': 'forwards',
    'Ù‚ÙÙ„ Ø§Ù„ØªØ§Ù‚': 'tags', 'ÙØªØ­ Ø§Ù„ØªØ§Ù‚': 'tags',
    'Ù‚ÙÙ„ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©': 'arabic', 'ÙØªØ­ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©': 'arabic',
    'Ù‚ÙÙ„ Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©': 'english', 'ÙØªØ­ Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©': 'english',
    'Ù‚ÙÙ„ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰': 'music', 'ÙØªØ­ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰': 'music',
    'Ù‚ÙÙ„ Ø§Ù„Ù…Ø¹Ø±ÙØ§Øª': 'usernames', 'ÙØªØ­ Ø§Ù„Ù…Ø¹Ø±ÙØ§Øª': 'usernames',
    'Ù‚ÙÙ„ Ø¬Ù‡Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„': 'contacts', 'ÙØªØ­ Ø¬Ù‡Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„': 'contacts',
    'Ù‚ÙÙ„ Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨': 'games', 'ÙØªØ­ Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨': 'games',
    'Ù‚ÙÙ„ Ø§Ù„Ø±ÙˆØ§Ø¨Ø·': 'links', 'ÙØªØ­ Ø§Ù„Ø±ÙˆØ§Ø¨Ø·': 'links',
    'Ù‚ÙÙ„ Ø§Ù„Ø¨ÙˆØªØ§Øª': 'bots', 'ÙØªØ­ Ø§Ù„Ø¨ÙˆØªØ§Øª': 'bots',
    'Ù‚ÙÙ„ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„': 'welcome', 'ÙØªØ­ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„': 'welcome',
    'Ù‚ÙÙ„ Ù‚Ø±Ø§Ù† ÙƒØ±ÙŠÙ…': 'quran', 'ÙØªØ­ Ù‚Ø±Ø§Ù† ÙƒØ±ÙŠÙ…': 'quran'
}

@bot.message_handler(func=lambda m: m.text in lock_commands.keys())
def handle_lock_commands(message):
    if not is_group_chat(message.chat.id) or not can_manage_users(message.chat.id, message.from_user.id):
        return
        
    # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
    if not check_subscription(message.from_user.id):
        send_subscription_message(message.chat.id, message.from_user.id)
        return
        
    command = message.text
    setting_type = lock_commands[command]
    action = "Ù‚ÙÙ„" if command.startswith("Ù‚ÙÙ„") else "ÙØªØ­"
    
    chat_id_str = str(message.chat.id)
    if chat_id_str not in group_settings:
        group_settings[chat_id_str] = {}
    
    group_settings[chat_id_str][setting_type] = (action == "Ù‚ÙÙ„")
    save_data(GROUP_SETTINGS_FILE, group_settings)
    
    bot.reply_to(message, f"âœ… ØªÙ… {command} Ø¨Ù†Ø¬Ø§Ø­!")

# --- Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ---
@bot.message_handler(func=lambda m: m.text in ['ÙƒØªÙ…', 'Ø­Ø¸Ø±', 'ÙÙƒ ÙƒØªÙ…', 'ÙÙƒ Ø­Ø¸Ø±'] and m.reply_to_message)
def manage_users(message):
    if not is_group_chat(message.chat.id) or not can_manage_users(message.chat.id, message.from_user.id):
        return
        
    # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
    if not check_subscription(message.from_user.id):
        send_subscription_message(message.chat.id, message.from_user.id)
        return
        
    user_id = message.reply_to_message.from_user.id
    command = message.text
    
    try:
        if command == 'ÙƒØªÙ…':
            bot.restrict_chat_member(message.chat.id, user_id, can_send_messages=False)
            bot.reply_to(message, f"âœ… ØªÙ… ÙƒØªÙ… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…")
        elif command == 'Ø­Ø¸Ø±':
            bot.ban_chat_member(message.chat.id, user_id)
            bot.reply_to(message, f"âœ… ØªÙ… Ø­Ø¸Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…")
        elif command == 'ÙÙƒ ÙƒØªÙ…':
            bot.restrict_chat_member(message.chat.id, user_id, can_send_messages=True)
            bot.reply_to(message, f"âœ… ØªÙ… ÙÙƒ ÙƒØªÙ… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…")
        elif command == 'ÙÙƒ Ø­Ø¸Ø±':
            bot.unban_chat_member(message.chat.id, user_id)
            bot.reply_to(message, f"âœ… ØªÙ… ÙÙƒ Ø­Ø¸Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…")
    except Exception as e:
        bot.reply_to(message, f"âŒ Ø®Ø·Ø£: {e}")

@bot.message_handler(func=lambda m: m.text.startswith(('Ø±ÙØ¹ Ù…Ø´Ø±Ù', 'ØªÙ†Ø²ÙŠÙ„ Ù…Ø´Ø±Ù', 'Ø±ÙØ¹ Ù…Ù…ÙŠØ²', 'ØªÙ†Ø²ÙŠÙ„ Ù…Ù…ÙŠØ²')) and m.reply_to_message)
def manage_roles(message):
    if not is_group_chat(message.chat.id) or not can_manage_users(message.chat.id, message.from_user.id):
        return
        
    # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
    if not check_subscription(message.from_user.id):
        send_subscription_message(message.chat.id, message.from_user.id)
        return
        
    target_user = message.reply_to_message.from_user
    chat_id_str = str(message.chat.id)
    user_id_str = str(target_user.id)
    
    if chat_id_str not in group_roles:
        group_roles[chat_id_str] = {'admins': [], 'vips': []}
    
    if message.text.startswith('Ø±ÙØ¹ Ù…Ø´Ø±Ù'):
        if user_id_str not in group_roles[chat_id_str]['admins']:
            group_roles[chat_id_str]['admins'].append(user_id_str)
            save_data(GROUP_ROLES_FILE, group_roles)
            bot.reply_to(message, f"âœ… ØªÙ… Ø±ÙØ¹ {target_user.first_name} Ù…Ø´Ø±ÙØ§Ù‹")
        else:
            bot.reply_to(message, f"âš ï¸ Ù‡Ùˆ Ø¨Ø§Ù„ÙØ¹Ù„ Ù…Ø´Ø±Ù!")
            
    elif message.text.startswith('ØªÙ†Ø²ÙŠÙ„ Ù…Ø´Ø±Ù'):
        if user_id_str in group_roles[chat_id_str]['admins']:
            group_roles[chat_id_str]['admins'].remove(user_id_str)
            save_data(GROUP_ROLES_FILE, group_roles)
            bot.reply_to(message, f"âœ… ØªÙ… ØªÙ†Ø²ÙŠÙ„ {target_user.first_name} Ù…Ù† Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ†")
        else:
            bot.reply_to(message, f"âš ï¸ Ù„ÙŠØ³ Ù…Ø´Ø±ÙØ§Ù‹!")
            
    elif message.text.startswith('Ø±ÙØ¹ Ù…Ù…ÙŠØ²'):
        if user_id_str not in group_roles[chat_id_str]['vips']:
            group_roles[chat_id_str]['vips'].append(user_id_str)
            save_data(GROUP_ROLES_FILE, group_roles)
            bot.reply_to(message, f"âœ… ØªÙ… Ø±ÙØ¹ {target_user.first_name} Ù…Ù…ÙŠØ²Ø§Ù‹")
        else:
            bot.reply_to(message, f"âš ï¸ Ù‡Ùˆ Ø¨Ø§Ù„ÙØ¹Ù„ Ù…Ù…ÙŠØ²!")
            
    elif message.text.startswith('ØªÙ†Ø²ÙŠÙ„ Ù…Ù…ÙŠØ²'):
        if user_id_str in group_roles[chat_id_str]['vips']:
            group_roles[chat_id_str]['vips'].remove(user_id_str)
            save_data(GROUP_ROLES_FILE, group_roles)
            bot.reply_to(message, f"âœ… ØªÙ… ØªÙ†Ø²ÙŠÙ„ {target_user.first_name} Ù…Ù† Ø§Ù„Ù…Ù…ÙŠØ²ÙŠÙ†")
        else:
            bot.reply_to(message, f"âš ï¸ Ù„ÙŠØ³ Ù…Ù…ÙŠØ²Ø§Ù‹!")

# --- Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯ ---
@bot.message_handler(func=lambda m: m.text in ['Ø§Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¨Ù†ÙƒÙŠ', 'Ø­Ø³Ø§Ø¨ÙŠ', 'ÙÙ„ÙˆØ³ÙŠ', 'Ø±Ø§ØªØ¨'])
def economy_commands(message):
    # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
    if not check_subscription(message.from_user.id):
        send_subscription_message(message.chat.id, message.from_user.id)
        return
        
    user_data = get_user_data(message.from_user.id)
    user_name = message.from_user.first_name
    
    if message.text == 'Ø§Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¨Ù†ÙƒÙŠ':
        if user_data.get('bank_account'):
            bot.reply_to(message, "âŒ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ Ø¨Ù†ÙƒÙŠ Ø¨Ø§Ù„ÙØ¹Ù„!")
            return
            
        banks = ["Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„ÙˆØ·Ù†ÙŠ", "Ø§Ù„Ù‚Ø±Ø¶ Ø§Ù„Ø´Ø¹Ø¨ÙŠ", "Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ", "Ø¨Ù†Ùƒ Ø§Ù„Ø¨Ø±ÙƒØ©"]
        account_number = ''.join(random.choices(string.digits, k=10))
        user_data['bank_account'] = {
            'bank': random.choice(banks),
            'number': account_number,
            'balance': random.randint(1000, 5000)
        }
        update_user_data(message.from_user.id, user_data)
        bot.reply_to(message, f"âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¨Ù†ÙƒÙŠ ÙÙŠ {user_data['bank_account']['bank']}\nØ±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨: {account_number}")
        
    elif message.text in ['Ø­Ø³Ø§Ø¨ÙŠ', 'ÙÙ„ÙˆØ³ÙŠ']:
        if user_data.get('bank_account'):
            bank_info = user_data['bank_account']
            job_text = f"ğŸ’¼ Ø§Ù„ÙˆØ¸ÙŠÙØ©: {user_data.get('job', 'Ù„Ø§ ÙŠÙˆØ¬Ø¯')}" 
            money_text = f"ğŸ’µ Ø§Ù„Ù†Ù‚ÙˆØ¯: {user_data.get('money', 0)}$"
            bot.reply_to(message, f"ğŸ¦ Ø§Ù„Ø¨Ù†Ùƒ: {bank_info['bank']}\nğŸ”¢ Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨: {bank_info['number']}\nğŸ’° Ø§Ù„Ø±ØµÙŠØ¯: {bank_info['balance']} Ø¯ÙŠÙ†Ø§Ø±\n{job_text}\n{money_text}")
        else:
            money_text = f"ğŸ’µ Ø§Ù„Ù†Ù‚ÙˆØ¯: {user_data.get('money', 0)}$"
            job_text = f"ğŸ’¼ Ø§Ù„ÙˆØ¸ÙŠÙØ©: {user_data.get('job', 'Ù„Ø§ ÙŠÙˆØ¬Ø¯')}"
            bot.reply_to(message, f"âŒ Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ Ø¨Ù†ÙƒÙŠ!\n{job_text}\n{money_text}\nØ§ÙƒØªØ¨ 'Ø§Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¨Ù†ÙƒÙŠ' Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨")
            
    elif message.text == 'Ø±Ø§ØªØ¨':
        if not user_data.get('job'):
            bot.reply_to(message, "âŒ Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ÙˆØ¸ÙŠÙØ©! Ø§ÙƒØªØ¨ 'Ø¹Ù…Ù„' Ù„Ø±Ø¤ÙŠØ© Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…ØªØ§Ø­Ø©")
            return
            
        now = time.time()
        last_salary = user_data.get('last_salary')
        
        # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ù†Ù‚Ø¶ÙŠ Ù…Ù†Ø° Ø¢Ø®Ø± Ø±Ø§ØªØ¨
        if last_salary:
            # Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† last_salary Ù‡Ùˆ Ø±Ù‚Ù… ÙˆÙ„ÙŠØ³ Ù†Øµ
            try:
                last_salary = float(last_salary)
            except (ValueError, TypeError):
                # Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù‚ÙŠÙ…Ø©ØŒ Ù†Ø¹Ø·ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø±Ø§ØªØ¨ Ø¬Ø¯ÙŠØ¯
                last_salary = None
            
            if last_salary and (now - last_salary) < 86400:  # 24 Ø³Ø§Ø¹Ø©
                remaining = 86400 - (now - last_salary)
                hours = int(remaining // 3600)
                minutes = int((remaining % 3600) // 60)
                bot.reply_to(message, f"â³ ÙŠØ¬Ø¨ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± {hours} Ø³Ø§Ø¹Ø© Ùˆ {minutes} Ø¯Ù‚ÙŠÙ‚Ø© Ù„Ù„Ø±Ø§ØªØ¨ Ø§Ù„ØªØ§Ù„ÙŠ")
                return
            
        job_info = JOBS[user_data['job']]
        salary = random.randint(job_info['min_salary'], job_info['max_salary'])
        
        # Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† money Ù‡Ùˆ Ø±Ù‚Ù…
        current_money = user_data.get('money', 0)
        try:
            current_money = int(current_money)
        except (ValueError, TypeError):
            current_money = 0
            
        user_data['money'] = current_money + salary
        user_data['last_salary'] = now  # Ø­ÙØ¸ ÙƒØ±Ù‚Ù… ÙˆÙ„ÙŠØ³ Ù†Øµ
        
        update_user_data(message.from_user.id, user_data)
        bot.reply_to(message, f"ğŸ’° Ø­ØµÙ„Øª Ø¹Ù„Ù‰ Ø±Ø§ØªØ¨ {salary} Ø¯ÙˆÙ„Ø§Ø±\nğŸ’¼ ÙˆØ¸ÙŠÙØªÙƒ: {user_data['job']} {job_info['emoji']}\nğŸ’µ Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯: {user_data['money']} Ø¯ÙˆÙ„Ø§Ø±")

@bot.message_handler(func=lambda m: m.text == 'Ø¹Ù…Ù„')
def show_jobs(message):
    # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
    if not check_subscription(message.from_user.id):
        send_subscription_message(message.chat.id, message.from_user.id)
        return
        
    jobs_text = "ğŸ’¼ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…ØªØ§Ø­Ø©:\n"
    for job, info in JOBS.items():
        jobs_text += f"{info['emoji']} {job}: {info['min_salary']}-{info['max_salary']}$\n"
    jobs_text += "\nØ±Ø¯ Ø¹Ù„Ù‰ Ù‡Ø°Ù‡ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨ÙƒØªØ§Ø¨Ø© 'ÙˆØ¸ÙŠÙØ© [Ø§Ø³Ù… Ø§Ù„ÙˆØ¸ÙŠÙØ©]'"
    bot.reply_to(message, jobs_text)

@bot.message_handler(func=lambda m: m.text.startswith('ÙˆØ¸ÙŠÙØ© '))
def apply_job(message):
    # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
    if not check_subscription(message.from_user.id):
        send_subscription_message(message.chat.id, message.from_user.id)
        return
        
    job_name = message.text[6:].strip()
    if job_name not in JOBS:
        bot.reply_to(message, "âŒ Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ¸ÙŠÙØ© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©! Ø§Ø³ØªØ®Ø¯Ù… 'Ø¹Ù…Ù„' Ù„Ø±Ø¤ÙŠØ© Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…ØªØ§Ø­Ø©")
        return
        
    user_data = get_user_data(message.from_user.id)
    user_data['job'] = job_name
    update_user_data(message.from_user.id, user_data)
    bot.reply_to(message, f"âœ… ØªÙ… ØªØ¹ÙŠÙŠÙ†Ùƒ ÙƒÙ€ {job_name} {JOBS[job_name]['emoji']}!")

@bot.message_handler(func=lambda m: m.text.startswith('Ø±ÙˆØ­ ') and m.reply_to_message)
def transfer_money(message):
    # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
    if not check_subscription(message.from_user.id):
        send_subscription_message(message.chat.id, message.from_user.id)
        return
        
    try:
        amount = int(message.text.split()[1])
        if amount <= 0:
            bot.reply_to(message, "âŒ Ø§Ù„Ù…Ø¨Ù„Øº ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„ØµÙØ±!")
            return
            
        sender_data = get_user_data(message.from_user.id)
        
        # Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† money Ù‡Ùˆ Ø±Ù‚Ù…
        sender_money = sender_data.get('money', 0)
        try:
            sender_money = int(sender_money)
        except (ValueError, TypeError):
            sender_money = 0
            
        if sender_money < amount:
            bot.reply_to(message, "âŒ Ù„Ø§ ØªÙ…Ù„Ùƒ Ù…Ø§ ÙŠÙƒÙÙŠ Ù…Ù† Ø§Ù„Ù…Ø§Ù„!")
            return
            
        receiver_id = message.reply_to_message.from_user.id
        receiver_data = get_user_data(receiver_id)
        
        # Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† money Ù‡Ùˆ Ø±Ù‚Ù… Ù„Ù„Ù…Ø³ØªÙ„Ù… Ø£ÙŠØ¶Ø§
        receiver_money = receiver_data.get('money', 0)
        try:
            receiver_money = int(receiver_money)
        except (ValueError, TypeError):
            receiver_money = 0
        
        sender_data['money'] = sender_money - amount
        receiver_data['money'] = receiver_money + amount
        
        update_user_data(message.from_user.id, sender_data)
        update_user_data(receiver_id, receiver_data)
        
        bot.reply_to(message, f"âœ… ØªÙ… ØªØ­ÙˆÙŠÙ„ {amount}$ Ø¥Ù„Ù‰ {message.reply_to_message.from_user.first_name}")
    except ValueError:
        bot.reply_to(message, "âŒ Ø§Ø³ØªØ®Ø¯Ù…: Ø±ÙˆØ­ [Ø§Ù„Ù…Ø¨Ù„Øº] Ø¨Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø®Øµ\nÙ…Ø«Ø§Ù„: Ø±ÙˆØ­ 100")
    except Exception as e:
        bot.reply_to(message, f"âŒ Ø­Ø¯Ø« Ø®Ø·Ø£: {e}")

# ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø¹ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
def get_user_data(user_id):
    user_id_str = str(user_id)
    if user_id_str not in user_data:
        user_data[user_id_str] = {
            "money": 1000,
            "job": None,
            "last_salary": None,
            "married_to": None,
            "last_daily": None,
            "bank_account": None,
            "messages_count": 0,
            "rob_count": 0,
            "rob_success": 0,
            "created_at": datetime.now().strftime("%Y-%m-%d %H:%M:%S")
        }
        save_data(USER_DATA_FILE, user_data)
    
    # Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø±Ù‚Ù…ÙŠØ© Ù‡ÙŠ Ø£Ø±Ù‚Ø§Ù… ÙˆÙ„ÙŠØ³ Ù†ØµÙˆØµ
    user_info = user_data[user_id_str]
    
    # Ø¥ØµÙ„Ø§Ø­ Ù‚ÙŠÙ…Ø© money
    if 'money' in user_info:
        try:
            user_info['money'] = int(user_info['money'])
        except (ValueError, TypeError):
            user_info['money'] = 1000  # Ù‚ÙŠÙ…Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª ØºÙŠØ± ØµØ§Ù„Ø­Ø©
    
    # Ø¥ØµÙ„Ø§Ø­ Ù‚ÙŠÙ…Ø© last_salary
    if 'last_salary' in user_info and user_info['last_salary'] is not None:
        try:
            user_info['last_salary'] = float(user_info['last_salary'])
        except (ValueError, TypeError):
            user_info['last_salary'] = None
    
    return user_info

# ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
def update_user_data(user_id, data):
    user_id_str = str(user_id)
    user_data[user_id_str] = data
    save_data(USER_DATA_FILE, user_data)

@bot.message_handler(func=lambda m: m.text == 'Ù…Ù‡Ø±' and m.reply_to_message)
def marriage(message):
    # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
    if not check_subscription(message.from_user.id):
        send_subscription_message(message.chat.id, message.from_user.id)
        return
        
    user_data = get_user_data(message.from_user.id)
    target_data = get_user_data(message.reply_to_message.from_user.id)
    
    if user_data['married_to']:
        bot.reply_to(message, "âŒ Ø£Ù†Øª Ù…ØªØ²ÙˆØ¬ Ø¨Ø§Ù„ÙØ¹Ù„!")
        return
        
    if target_data['married_to']:
        bot.reply_to(message, "âŒ Ù‡Ø°Ø§ Ø§Ù„Ø´Ø®Øµ Ù…ØªØ²ÙˆØ¬ Ø¨Ø§Ù„ÙØ¹Ù„!")
        return
        
    mahr_amount = 1000
    if user_data['money'] < mahr_amount:
        bot.reply_to(message, f"âŒ ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ {mahr_amount}$ Ù„Ù„Ù…Ù‡Ø±!")
        return
        
    user_data['money'] -= mahr_amount
    user_data['married_to'] = message.reply_to_message.from_user.id
    target_data['married_to'] = message.from_user.id
    
    update_user_data(message.from_user.id, user_data)
    update_user_data(message.reply_to_message.from_user.id, target_data)
    
    bot.reply_to(message, f"ğŸ’ Ù…Ø¨Ø±ÙˆÙƒ! ØªØ²ÙˆØ¬Øª Ù…Ù† {message.reply_to_message.from_user.first_name}!")

@bot.message_handler(func=lambda m: m.text.startswith('ÙƒÙˆØ¯ '))
def use_code(message):
    # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
    if not check_subscription(message.from_user.id):
        send_subscription_message(message.chat.id, message.from_user.id)
        return
        
    code = message.text[5:].strip().upper()
    if code not in codes_data:
        bot.reply_to(message, "âŒ Ø§Ù„ÙƒÙˆØ¯ ØºÙŠØ± ØµØ­ÙŠØ­!")
        return
        
    code_info = codes_data[code]
    if code_info['used']:
        bot.reply_to(message, "âŒ Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„!")
        return
        
    user_data = get_user_data(message.from_user.id)
    user_data['money'] += code_info['amount']
    code_info['used'] = True
    codes_data[code] = code_info
    
    update_user_data(message.from_user.id, user_data)
    save_data(CODES_FILE, codes_data)
    
    bot.reply_to(message, f"âœ… ØªÙ… Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„ÙƒÙˆØ¯! +{code_info['amount']}$")

# --- Ø£ÙˆØ§Ù…Ø± Ø§Ù„ØªÙˆØ¨ ---
@bot.message_handler(func=lambda m: m.text in ['ØªÙˆØ¨', 'ØªÙˆØ¨ Ø§Ù„ÙÙ„ÙˆØ³', 'ØªÙˆØ¨ Ø§Ù„Ø­Ø±Ø§Ù…ÙŠØ©', 'ØªÙˆØ¨ Ø§Ù„Ø­Ø±Ø§Ù…ÙŠÙ‡', 'ØªÙˆØ¨ Ø§Ù„Ø²Ø±Ù'])
def top_commands(message):
    # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
    if not check_subscription(message.from_user.id):
        send_subscription_message(message.chat.id, message.from_user.id)
        return
        
    if message.text == 'ØªÙˆØ¨':
        bot.reply_to(message, "ğŸ“Š Ø£ÙˆØ§Ù…Ø± Ø§Ù„ØªÙˆØ¨:\nØªÙˆØ¨ Ø§Ù„ÙÙ„ÙˆØ³ - ØªÙˆØ¨ Ø§Ù„Ø­Ø±Ø§Ù…ÙŠØ© - ØªÙˆØ¨ Ø§Ù„Ø²Ø±Ù")
        return
        
    # Ù†Ù…ÙˆØ°Ø¬ Ù…Ø¨Ø³Ø· Ù„Ù„ØªÙˆØ¨
    top_users = [
        {"name": "Ø£Ø­Ù…Ø¯", "value": 15000},
        {"name": "ÙØ§Ø·Ù…Ø©", "value": 12000},
        {"name": "Ù…Ø­Ù…Ø¯", "value": 9500},
        {"name": message.from_user.first_name, "value": random.randint(1000, 5000)}
    ]
    top_users.sort(key=lambda x: x["value"], reverse=True)
    
    if message.text == 'ØªÙˆØ¨ Ø§Ù„ÙÙ„ÙˆØ³':
        text = "ğŸ† ØªÙˆØ¨ Ø§Ù„ÙÙ„ÙˆØ³:\n"
        for i, user in enumerate(top_users[:5], 1):
            text += f"{i}. {user['name']} - {user['value']}$\n"
        bot.reply_to(message, text)
        
    elif message.text in ['ØªÙˆØ¨ Ø§Ù„Ø­Ø±Ø§Ù…ÙŠØ©', 'ØªÙˆØ¨ Ø§Ù„Ø­Ø±Ø§Ù…ÙŠÙ‡', 'ØªÙˆØ¨ Ø§Ù„Ø²Ø±Ù']:
        text = "ğŸ† ØªÙˆØ¨ Ø§Ù„Ø­Ø±Ø§Ù…ÙŠØ©:\n"
        for i, user in enumerate(top_users[:5], 1):
            text += f"{i}. {user['name']} - {user['value']} Ø¹Ù…Ù„ÙŠØ©\n"
        bot.reply_to(message, text)

# --- Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ---
@bot.message_handler(func=lambda m: m.text in ['Ø±ØªØ¨ØªÙŠ', 'Ø§Ù„Ù…Ø§Ù„Ùƒ', 'Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ†', 'Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ†', 'Ø§ÙŠØ¯ÙŠ', 'id', 'Ø§Ù„Ø§ÙŠØ¯ÙŠ', 'Ø§Ù„Ù…Ø·ÙˆØ±', 'Ù…Ø·ÙˆØ±'])
def info_commands(message):
    # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
    if not check_subscription(message.from_user.id):
        send_subscription_message(message.chat.id, message.from_user.id)
        return
        
    if message.text in ['Ø±ØªØ¨ØªÙŠ']:
        role = get_user_role(message.chat.id, message.from_user.id)
        role_text = {
            'admin': 'Ù…Ø´Ø±Ù Ø§Ù„Ø¨ÙˆØª', 'vip': 'Ù…Ù…ÙŠØ²',
            'group_admin': 'Ù…Ø´Ø±Ù Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©', 'member': 'Ø¹Ø¶Ùˆ'
        }.get(role, 'Ø¹Ø¶Ùˆ')
        bot.reply_to(message, f"ğŸ“Š Ø±ØªØ¨ØªÙƒ: {role_text}")
        
    elif message.text in ['Ø§Ù„Ù…Ø§Ù„Ùƒ', 'Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ†', 'Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ†']:
        try:
            admins = bot.get_chat_administrators(message.chat.id)
            admin_list = "ğŸ‘¥ Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ†:\n"
            for admin in admins:
                status = "ğŸ‘‘ Ù…Ø§Ù„Ùƒ" if admin.status == 'creator' else "ğŸ›¡ï¸ Ù…Ø´Ø±Ù"
                admin_list += f"{status} - {admin.user.first_name}\n"
            bot.reply_to(message, admin_list)
        except:
            bot.reply_to(message, "âŒ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¬Ù„Ø¨ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ†")
            
    elif message.text in ['Ø§ÙŠØ¯ÙŠ', 'id', 'Ø§Ù„Ø§ÙŠØ¯ÙŠ']:
        try:
            target = message.reply_to_message.from_user if message.reply_to_message else message.from_user
            chat_id = message.chat.id

            # Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„
            name = target.first_name
            if target.last_name:
                name += " " + target.last_name

            # Ø§Ù„Ù…Ø¹Ø±Ù
            username = f"@{target.username}" if target.username else "Ù„Ø§ ÙŠÙˆØ¬Ø¯"

            # Ø§Ù„Ø±ØªØ¨Ø© ÙÙŠ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©
            try:
                member = bot.get_chat_member(chat_id, target.id)
                status_map = {
                    'creator': 'ğŸ‘‘ Ù…Ø§Ù„Ùƒ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©',
                    'administrator': 'ğŸ›¡ï¸ Ù…Ø´Ø±Ù Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©',
                    'member': 'ğŸ‘¤ Ø¹Ø¶Ùˆ'
                }
                rank = status_map.get(member.status, 'ğŸ‘¤ Ø¹Ø¶Ùˆ')
                title = member.custom_title or "Ù„Ø§ ÙŠÙˆØ¬Ø¯"
            except:
                rank = "ğŸ‘¤ Ø¹Ø¶Ùˆ"
                title = "Ù„Ø§ ÙŠÙˆØ¬Ø¯"

            # Ø§Ù„Ø¨Ø§ÙŠÙˆ
            bio = "Ù„Ø§ ÙŠÙˆØ¬Ø¯"
            try:
                full_user = bot.get_chat(target.id)
                if full_user.bio:
                    bio = full_user.bio
            except:
                bio = "Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¬Ù„Ø¨ Ø§Ù„Ø¨Ø§ÙŠÙˆ"

            # Ø¹Ø¯ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ (ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ø·Ø±ÙŠÙ‚Ø© Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ù‡Ù†Ø§)
            msg_count = "0"  # ÙŠÙ…ÙƒÙ† ØªØ·ÙˆÙŠØ±Ù‡ Ù„Ø§Ø­Ù‚Ù‹Ø§

            # ØªØ§Ø±ÙŠØ® Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ (ØªÙ‚Ø¯ÙŠØ± ÙˆØ§Ù‚Ø¹ÙŠ)
            try:
                user_id_num = target.id
                if user_id_num < 2_000_000_000:
                    creation_date_str = "2018/01/01"
                elif user_id_num < 4_000_000_000:
                    creation_date_str = "2020/06/01"
                elif user_id_num < 6_000_000_000:
                    creation_date_str = "2022/01/01"
                elif user_id_num < 8_000_000_000:
                    creation_date_str = "2023/06/01"
                else:
                    creation_date_str = "2024/01/01"
            except:
                creation_date_str = "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ"

            # Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù†Øµ (Ø¨Ø¯ÙˆÙ† Markdown Ù„ØªØ¬Ù†Ø¨ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡)
            info_text = (
                f"É´á´€á´á´‡- {name}\n"
                f"á´œÑ•á´‡- {username}\n"
                f"Ñ•á´›á´€- {rank}\n"
                f"á´Ñ•É¢- {msg_count}\n"
                f"Éªá´…- {target.id}\n"
                f"á´›Éªá´›ÊŸá´‡- {title}\n"
                f"Ê™Éªá´- {bio}\n"
                f"á´„Ê€á´‡á´€á´›á´‡- {creation_date_str}"
            )

            # Ø¬Ù„Ø¨ Ø§Ù„ØµÙˆØ±Ø©
            try:
                photos = bot.get_user_profile_photos(target.id, limit=1)
                if photos.total_count > 0:
                    file_id = photos.photos[0][0].file_id
                    bot.send_photo(chat_id, file_id, caption=info_text)
                else:
                    bot.reply_to(message, info_text)
            except Exception as e:
                bot.reply_to(message, info_text)
                logger.error(f"Error fetching user photo: {e}")

        except Exception as e:
            bot.reply_to(message, "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª.")
            logger.error(f"Error in show_id: {e}")
        
    elif message.text in ['Ø§Ù„Ù…Ø·ÙˆØ±', 'Ù…Ø·ÙˆØ±']:
        # Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØµÙˆØ±Ø© Ø§Ù„Ù…Ø·ÙˆØ± ÙˆØªØ­Ø¯ÙŠØ«Ù‡Ø§
        photo_data = get_developer_photo()
        
        if photo_data:
            # Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø© Ù…Ø¹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø·ÙˆØ±
            bot.send_photo(message.chat.id, photo_data, 
                          caption="ğŸ‘¨â€ğŸ’» Ø§Ù„Ù…Ø·ÙˆØ±: MAYKEL\nğŸ”— @MBl_py\nğŸ†” 5545019702")
        else:
            bot.reply_to(message, "ğŸ‘¨â€ğŸ’» Ø§Ù„Ù…Ø·ÙˆØ±: MAYKEL\nğŸ”— @MBl_py\nğŸ†” 5545019702")

# --- Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ---
@bot.message_handler(func=lambda m: m.text in ['Ø§Ù„Ø§Ø¹Ø¯Ø§Ø¯Ø§Øª', '/settings'])
def settings_command(message):
    if not is_group_chat(message.chat.id):
        return
        
    # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
    if not check_subscription(message.from_user.id):
        send_subscription_message(message.chat.id, message.from_user.id)
        return
        
    text = """
ğŸ›¡ï¸ Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø­Ù…Ø§ÙŠØ©:

Ù‚ÙÙ„/ÙØªØ­ Ø§Ù„Ù…Ù„ØµÙ‚Ø§Øª
Ù‚ÙÙ„/ÙØªØ­ Ø§Ù„ØµÙˆØ±
Ù‚ÙÙ„/ÙØªØ­ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
Ù‚ÙÙ„/ÙØªØ­ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©
Ù‚ÙÙ„/ÙØªØ­ Ø§Ù„ØµÙˆØªÙŠØ§Øª
Ù‚ÙÙ„/ÙØªØ­ Ø§Ù„Ù…Ù„ÙØ§Øª
Ù‚ÙÙ„/ÙØªØ­ Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆØ¬ÙŠÙ‡
Ù‚ÙÙ„/ÙØªØ­ Ø§Ù„ØªØ§Ù‚
Ù‚ÙÙ„/ÙØªØ­ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
Ù‚ÙÙ„/ÙØªØ­ Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©
Ù‚ÙÙ„/ÙØªØ­ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰
Ù‚ÙÙ„/ÙØªØ­ Ø§Ù„Ù…Ø¹Ø±ÙØ§Øª
Ù‚ÙÙ„/ÙØªØ­ Ø¬Ù‡Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„
Ù‚ÙÙ„/ÙØªØ­ Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨
Ù‚ÙÙ„/ÙØªØ­ Ø§Ù„Ø±ÙˆØ§Ø¨Ø·
Ù‚ÙÙ„/ÙØªØ­ Ø§Ù„Ø¨ÙˆØªØ§Øª
Ù‚ÙÙ„/ÙØªØ­ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„
Ù‚ÙÙ„/ÙØªØ­ Ù‚Ø±Ø§Ù† ÙƒØ±ÙŠÙ…

ğŸ‘¥ Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©:
ÙƒØªÙ…/Ø­Ø¸Ø±/ÙÙƒ ÙƒØªÙ…/ÙÙƒ Ø­Ø¸Ø± (Ø¨Ø§Ù„Ø±Ø¯)
Ø±ÙØ¹/ØªÙ†Ø²ÙŠÙ„ Ù…Ø´Ø±Ù/Ù…Ù…ÙŠØ² (Ø¨Ø§Ù„Ø±Ø¯)

ğŸ’° Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯:
Ø§Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¨Ù†ÙƒÙŠ
Ø­Ø³Ø§Ø¨ÙŠ
ÙÙ„ÙˆØ³ÙŠ
Ø±Ø§ØªØ¨
Ø¹Ù…Ù„
Ø±ÙˆØ­ [Ø§Ù„Ù…Ø¨Ù„Øº] (Ø¨Ø§Ù„Ø±Ø¯)
Ù…Ù‡Ø± (Ø¨Ø§Ù„Ø±Ø¯)
ÙƒÙˆØ¯ [Ø§Ù„ÙƒÙˆØ¯]

ğŸ® Ø£ÙˆØ§Ù…Ø± Ø§Ù„ØªØ±ÙÙŠÙ‡:
Ø«Ø«ØŒ ÙƒØªØ§Ø¨ØŒ Ù†Ø±Ø¯ØŒ Ø²ÙˆØ¬Ù†ÙŠØŒ Ø§Ø­Ø¨ÙƒØŒ Ø¨ÙˆØ³Ø©ØŒ ØªÙØ§ØµÙŠÙ„ØŒ Ù‡ÙŠÙ†Ù‡

âŒ¯Ù‚Ù… Ø¨Ø§Ù„Ø±Ø¯ Ù‡Ù„Ù‰ Ø£ÙŠ Ø´Ø®Øµ ÙˆÙƒØªØ§Ø¨Ø© ÙƒÙ„ ØªÙ„Ùƒ Ø§Ù„Ø§ÙˆÙ…Ø±

ğŸ“Š Ø£ÙˆØ§Ù…Ø± Ø§Ù„ØªÙˆØ¨:
ØªÙˆØ¨ØŒ ØªÙˆØ¨ Ø§Ù„ÙÙ„ÙˆØ³ØŒ ØªÙˆØ¨ Ø§Ù„Ø­Ø±Ø§Ù…ÙŠØ©ØŒ ØªÙˆØ¨ Ø§Ù„Ø²Ø±Ù

â„¹ï¸ Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª:
Ø±ØªØ¨ØªÙŠØŒ Ø§Ù„Ù…Ø§Ù„ÙƒØŒ Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ†ØŒ Ø§ÙŠØ¯ÙŠØŒ Ø§Ù„Ù…Ø·ÙˆØ±
"""
    bot.reply_to(message, text)

# --- Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…Ø·ÙˆØ± ---
@bot.message_handler(func=lambda m: m.text.startswith(('Ø±ÙØ¹_Ø§Ø¯Ù…Ù†', 'Ø­Ø°Ù_Ø§Ø¯Ù…Ù†', 'ØªØ¹ÙŠÙŠÙ†_Ø§Ù„Ù…Ø§Ù„Ùƒ')) and m.reply_to_message)
def developer_commands(message):
    if not is_owner(message.from_user.id):
        return
        
    target_user = message.reply_to_message.from_user
    
    if message.text.startswith('Ø±ÙØ¹_Ø§Ø¯Ù…Ù†'):
        if target_user.id in admins_data['admins']:
            bot.reply_to(message, "âš ï¸ Ù‡Ùˆ Ø¨Ø§Ù„ÙØ¹Ù„ Ø§Ø¯Ù…Ù†!")
        else:
            admins_data['admins'].append(target_user.id)
            save_data(ADMINS_FILE, admins_data)
            bot.reply_to(message, f"âœ… ØªÙ… Ø±ÙØ¹ {target_user.first_name} Ø§Ø¯Ù…Ù†!")
            
    elif message.text.startswith('Ø­Ø°Ù_Ø§Ø¯Ù…Ù†'):
        if target_user.id in admins_data['admins']:
            admins_data['admins'].remove(target_user.id)
            save_data(ADMINS_FILE, admins_data)
            bot.reply_to(message, f"âœ… ØªÙ… Ø­Ø°Ù {target_user.first_name} Ù…Ù† Ø§Ù„Ø§Ø¯Ù…Ù†!")
        else:
            bot.reply_to(message, "âš ï¸ Ù„ÙŠØ³ Ø§Ø¯Ù…Ù†!")
            
    elif message.text.startswith('ØªØ¹ÙŠÙŠÙ†_Ø§Ù„Ù…Ø§Ù„Ùƒ'):
        admins_data['owner'] = target_user.id
        save_data(ADMINS_FILE, admins_data)
        bot.reply_to(message, f"âœ… ØªÙ… ØªØ¹ÙŠÙŠÙ† {target_user.first_name} Ù…Ø§Ù„ÙƒØ§Ù‹ Ø¬Ø¯ÙŠØ¯Ø§Ù‹!")

@bot.message_handler(func=lambda m: m.text.startswith('Ø§Ù†Ø´Ø§Ø¡_ÙƒÙˆØ¯ ') and is_admin(m.from_user.id))
def create_code_command(message):
    try:
        amount = int(message.text.split()[1])
        code = ''.join(random.choices(string.ascii_uppercase + string.digits, k=8))
        codes_data[code] = {'amount': amount, 'used': False, 'created_by': message.from_user.id}
        save_data(CODES_FILE, codes_data)
        bot.reply_to(message, f"âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙˆØ¯: {code}\nğŸ’° Ø§Ù„Ù‚ÙŠÙ…Ø©: {amount}$")
    except:
        bot.reply_to(message, "âŒ Ø§Ø³ØªØ®Ø¯Ù…: Ø§Ù†Ø´Ø§Ø¡_ÙƒÙˆØ¯ [Ø§Ù„Ù…Ø¨Ù„Øº]")

# --- Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ÙÙŠ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª ---
@bot.message_handler(content_types=['text', 'photo', 'video', 'audio', 'document', 'sticker', 'animation', 'voice', 'video_note', 'contact', 'location', 'venue', 'poll', 'dice'])
def handle_group_content(message):
    if not is_group_chat(message.chat.id):
        return
        
    # Ø²ÙŠØ§Ø¯Ø© Ø¹Ø¯Ø¯ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    user_info = get_user_data(message.from_user.id)
    user_info['messages_count'] = user_info.get('messages_count', 0) + 1
    update_user_data(message.from_user.id, user_info)
        
    chat_id_str = str(message.chat.id)
    if chat_id_str not in group_settings:
        return
        
    # Ø§Ù„Ø³Ù…Ø§Ø­ Ù„Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠÙ† ÙˆØ§Ù„Ù…Ø´Ø±ÙÙŠÙ† Ø¨Ø¥Ø±Ø³Ø§Ù„ Ø£ÙŠ Ù…Ø­ØªÙˆÙ‰
    if can_manage_users(message.chat.id, message.from_user.id):
        return
        
    settings = group_settings[chat_id_str]
    content_type = message.content_type
    
    # Ù…Ù†Ø¹ Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„ØªÙŠ ØªØ¨Ø¯Ø£ Ø¨Ù€ "Ù‚ÙÙ„" Ø£Ùˆ "ÙØªØ­" Ù…Ù† Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ø¹Ø§Ø¯ÙŠÙŠÙ†
    if content_type == 'text' and (message.text.startswith('Ù‚ÙÙ„') or message.text.startswith('ÙØªØ­')):
        try:
            bot.delete_message(message.chat.id, message.message_id)
            bot.send_message(message.chat.id, "âŒ Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù‡Ø°Ø§ Ø§Ù„Ø£Ù…Ø±!")
        except:
            pass
        return
    
    # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù‚ÙÙˆÙ„Ø©
    if ((content_type == 'sticker' and settings.get('stickers', False)) or
        (content_type == 'photo' and settings.get('photos', False)) or
        (content_type == 'video' and settings.get('videos', False)) or
        (content_type == 'text' and settings.get('texts', False)) or
        (content_type == 'audio' and settings.get('audios', False)) or
        (content_type == 'document' and settings.get('documents', False)) or
        (content_type == 'animation' and settings.get('animations', False)) or
        (content_type == 'voice' and settings.get('voices', False)) or
        (content_type == 'video_note' and settings.get('video_notes', False)) or
        (content_type == 'contact' and settings.get('contacts', False)) or
        (content_type == 'location' and settings.get('locations', False)) or
        (content_type == 'poll' and settings.get('polls', False)) or
        (content_type == 'dice' and settings.get('dice', False))):
        try:
            bot.delete_message(message.chat.id, message.message_id)
            warning_msg = bot.send_message(message.chat.id, f"âš ï¸ {message.from_user.first_name}ØŒ Ù‡Ø°Ø§ Ø§Ù„Ù†ÙˆØ¹ Ù…Ù† Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù…Ù‚ÙÙ„ Ø­Ø§Ù„ÙŠØ§Ù‹!")
            time.sleep(3)
            bot.delete_message(message.chat.id, warning_msg.message_id)
        except:
            pass

# ÙÙŠ Ù‚Ø³Ù… Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§ØªØŒ Ø£Ø¶Ù Ù…ØªØºÙŠØ±Ù‹Ø§ Ù„ØªØªØ¨Ø¹ ÙˆÙ‚Øª Ø¢Ø®Ø± Ù‚ÙÙ„ Ù„Ù„Ù‚Ø±Ø¢Ù†
group_quran_lock_times = {}

# ÙÙŠ Ù‚Ø³Ù… Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù‚ÙÙ„ØŒ Ø¹Ø¯Ù„ Ø£Ù…Ø± Ù‚ÙÙ„/ÙØªØ­ Ø§Ù„Ù‚Ø±Ø¢Ù†
@bot.message_handler(func=lambda m: m.text in ['Ù‚ÙÙ„ Ù‚Ø±Ø§Ù† ÙƒØ±ÙŠÙ…', 'ÙØªØ­ Ù‚Ø±Ø§Ù† ÙƒØ±ÙŠÙ…'])
def handle_quran_lock(message):
    if not is_group_chat(message.chat.id) or not can_manage_users(message.chat.id, message.from_user.id):
        return
        
    # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
    if not check_subscription(message.from_user.id):
        send_subscription_message(message.chat.id, message.from_user.id)
        return
        
    command = message.text
    chat_id_str = str(message.chat.id)
    
    if chat_id_str not in group_settings:
        group_settings[chat_id_str] = {}
    
    if command == 'Ù‚ÙÙ„ Ù‚Ø±Ø§Ù† ÙƒØ±ÙŠÙ…':
        group_settings[chat_id_str]['quran'] = True
        # Ø­ÙØ¸ ÙˆÙ‚Øª Ø§Ù„Ù‚ÙÙ„ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©
        group_quran_lock_times[chat_id_str] = time.time()
        bot.reply_to(message, "âœ… ØªÙ… Ù‚ÙÙ„ Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…ØŒ Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¢ÙŠØ© ÙƒÙ„ 15 Ø¯Ù‚ÙŠÙ‚Ø©")
    else:
        group_settings[chat_id_str]['quran'] = False
        # Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ù…Ù† Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙˆÙ‚ÙŠØª Ø¹Ù†Ø¯ Ø§Ù„ÙØªØ­
        if chat_id_str in group_quran_lock_times:
            del group_quran_lock_times[chat_id_str]
        bot.reply_to(message, "âœ… ØªÙ… ÙØªØ­ Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…")
    
    save_data(GROUP_SETTINGS_FILE, group_settings)

# Ø£Ø¶Ù Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØºÙŠØ± ÙÙŠ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù…Ù„Ù Ù…Ø¹ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰
group_quran_lock_times = {}

# Ø¹Ø¯Ù„ ÙˆØ¸ÙŠÙØ© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¢ÙŠØ§Øª Ø§Ù„Ù‚Ø±Ø¢Ù†ÙŠØ©
def send_quran_verses():
    global verse_index
    if not send_verses_enabled:
        return
        
    current_time = time.time()
    
    for chat_id_str in group_settings.keys():
        try:
            # Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù‚Ø±Ø¢Ù† Ù…Ù‚ÙÙˆÙ„Ø§Ù‹ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©
            if group_settings[chat_id_str].get('quran', False):
                # Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ Ù…Ø± 15 Ø¯Ù‚ÙŠÙ‚Ø© Ù…Ù†Ø° Ø¢Ø®Ø± Ø¥Ø±Ø³Ø§Ù„
                last_sent = group_quran_lock_times.get(chat_id_str, 0)
                if current_time - last_sent >= 900:  # 900 Ø«Ø§Ù†ÙŠØ© = 15 Ø¯Ù‚ÙŠÙ‚Ø©
                    chat_id = int(chat_id_str)
                    verse = QURAN_VERSES[verse_index]
                    bot.send_message(chat_id, f"ğŸ“– Ø¢ÙŠØ© Ù‚Ø±Ø¢Ù†ÙŠØ©:\n\n{verse}")
                    # ØªØ­Ø¯ÙŠØ« ÙˆÙ‚Øª Ø¢Ø®Ø± Ø¥Ø±Ø³Ø§Ù„ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©
                    group_quran_lock_times[chat_id_str] = current_time
                    verse_index = (verse_index + 1) % len(QURAN_VERSES)
                    
        except Exception as e:
            logger.error(f"Error sending verse to group {chat_id_str}: {e}")
    
    verse_index = (verse_index + 1) % len(QURAN_VERSES)

# Ø¹Ø¯Ù„ ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø¬Ø¯ÙˆÙ„Ø©
def schedule_verses():
    schedule.every(1).minutes.do(send_quran_verses)  # Ø§Ù„ØªØ­Ù‚Ù‚ ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©
    while True:
        schedule.run_pending()
        time.sleep(1)

# --- Ù…Ø¹Ø§Ù„Ø¬Ø© ÙƒÙ„Ù…Ø§Øª Ø®Ø§ØµØ© ---
@bot.message_handler(func=lambda message: message.text and 
                     any(keyword in message.text.strip().lower() for keyword in ['Ø®Ø§Øµ', 'ØªØ¹Ø§Ù„ Ø®Ø§Øµ', 'prv']))
def respond_to_private_request(message):
        # ØªØ¬Ù†Ø¨ Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø£ÙˆØ§Ù…Ø± Ù…Ø¹ÙŠÙ†Ø©
        if any(cmd in message.text.strip().lower() for cmd in ["Ù…Ø³Ø­ Ø¯Ø±Ø¯Ø´Ø©", "Ø­Ø°Ù Ø¯Ø±Ø¯Ø´Ø©", "ØªÙ†Ø¸ÙŠÙ"]):
            return

        # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙÙŠ Ù…Ø¬Ù…ÙˆØ¹Ø©
        if not is_group_chat(message.chat.id):
            return
        
        # Ø¥Ù†Ø´Ø§Ø¡ Ø²Ø± Ù„Ù„Ø°Ù‡Ø§Ø¨ Ø¥Ù„Ù‰ Ø§Ù„Ø®Ø§Øµ
        markup = telebot.types.InlineKeyboardMarkup()
        private_btn = telebot.types.InlineKeyboardButton("Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ Ø§Ù„Ø®Ø§Øµ ğŸš€", url=f"https://t.me/{bot.get_me().username}")
        markup.add(private_btn)

        # Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø¯ Ø§Ù„Ù…Ø¶Ø­Ùƒ Ù…Ø¹ Ø§Ù„Ø²Ø±
        funny_responses = [
            "ÙŠØ§ Ø¬Ù…Ø§Ø¹Ø©ØŒ Ø­Ø¯ ÙŠÙ‚ÙˆÙ„ Ù„ÙŠ Ù‡Ùˆ Ø¹Ø§ÙŠØ²Ù†ÙŠ ÙÙŠ Ø§Ù„Ø®Ø§Øµ Ù„ÙŠÙ‡ØŸ ğŸ¤”",
            "Ø¥Ù†ØªÙˆØ§ Ù…ØªØ¹Ø±ÙÙˆØ´ Ø¥Ù† Ø§Ù„Ø®Ø§Øµ Ù…Ø´ Ù…ÙƒØ§Ù† Ø¢Ù…Ù†ØŸ ğŸ˜",
            "Ù…Ø´ Ø¹Ø§Ø±Ù Ø¥ÙŠÙ‡ Ø§Ù„Ù„ÙŠ Ù‡Ø­ÙƒÙŠÙ„ÙƒÙˆØ§ ÙÙŠ Ø§Ù„Ø®Ø§Øµ Ù…Ø´ Ù‡ØªÙ‚Ø¯Ø±ÙˆÙ„ÙˆØ§ ØªÙ†Ø§Ù…ÙˆØ§ ğŸ˜‚",
            "ÙÙŠ Ø§Ù„Ø¥ÙŠØ¯ Ø®ÙŠØ± Ù…Ù† Ø£Ù„Ù ÙÙŠ Ø§Ù„Ø®Ø§Øµ! ğŸ‘",
            "Ø§Ù„Ø®Ø§Øµ Ø¯Ù‡ Ù…ÙƒØ§Ù† Ø®Ø·ÙŠØ±... Ø¨ØªÙƒÙˆÙ† ÙÙŠÙ‡ Ø£Ø³Ø±Ø§Ø±! ğŸ˜",
            "Ø´ÙƒÙ„Ùƒ Ø¹Ø§ÙŠØ² ØªØ­ÙƒÙŠÙ„ÙŠ Ø³Ø±ØŸ ØªØ¹Ø§Ù„ Ù„Ù„Ø®Ø§Øµ Ø¨Ø³ Ù…Ø´ Ù‡Ø¶Ù…Ù† Ø£Ù…Ø§Ù†Ù‡! ğŸ˜œ",
            "Ø§Ù„Ø®Ø§ØµØŸ Ø£Ù†Ø§ Ù…Ø´ Ø¯ÙƒØªÙˆØ± Ù†ÙØ³ÙŠ Ø¹Ø´Ø§Ù† ØªÙŠØ¬ÙŠÙ„ÙŠ ÙÙŠ Ø§Ù„Ø®Ø§Øµ! ğŸ¤£"
        ]
        selected_response = random.choice(funny_responses)
        bot.reply_to(message, f"{selected_response}\n\nØ§Ø¶ØºØ· Ø§Ù„Ø²Ø± Ø¹Ø´Ø§Ù† ØªØ´ÙˆÙ Ù…Ø¹Ø¬Ø²Ø© ğŸ‘‡", reply_markup=markup)

# --- ØªØ­Ø¯ÙŠØ« ØµÙˆØ±Ø© Ø§Ù„Ù…Ø·ÙˆØ± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ---
def update_developer_photo_periodically():
    """ØªØ­Ø¯ÙŠØ« ØµÙˆØ±Ø© Ø§Ù„Ù…Ø·ÙˆØ± ÙƒÙ„ Ø³Ø§Ø¹Ø©"""
    while True:
        try:
            get_developer_photo()
            time.sleep(3600)  # Ø§Ù†ØªØ¸Ø§Ø± Ø³Ø§Ø¹Ø©
        except Exception as e:
            logger.error(f"Error in update_developer_photo_periodically: {e}")
            time.sleep(300)  # Ø§Ù†ØªØ¸Ø§Ø± 5 Ø¯Ù‚Ø§Ø¦Ù‚ ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£

# Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…Ø·ÙˆØ±
photo_update_thread = threading_Thread(target=update_developer_photo_periodically)
photo_update_thread.daemon = True
photo_update_thread.start()

# --- Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø¥Ø¯Ù…Ù† ---
@bot.message_handler(func=lambda m: m.text == 'Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…' and is_admin(m.from_user.id))
def admin_panel(message):
    markup = telebot.types.InlineKeyboardMarkup(row_width=2)
    
    btn1 = telebot.types.InlineKeyboardButton("Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙˆØ¯", callback_data="create_code")
    btn2 = telebot.types.InlineKeyboardButton("Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª", callback_data="stats")
    btn3 = telebot.types.InlineKeyboardButton("Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±", callback_data="send_notification")
    btn4 = telebot.types.InlineKeyboardButton("Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª", callback_data="manage_groups")
    
    markup.add(btn1, btn2, btn3, btn4)
    
    bot.reply_to(message, "ğŸ‘¨â€ğŸ’» Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø¥Ø¯Ù…Ù†:", reply_markup=markup)

@bot.callback_query_handler(func=lambda call: call.data == "create_code")
def handle_create_code(call):
    if is_admin(call.from_user.id):
        bot.answer_callback_query(call.id, "Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø£Ù…Ø±: Ø§Ù†Ø´Ø§Ø¡_ÙƒÙˆØ¯ [Ø§Ù„Ù…Ø¨Ù„Øº]")
    else:
        bot.answer_callback_query(call.id, "âŒ Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ©!")

@bot.callback_query_handler(func=lambda call: call.data == "stats")
def handle_stats(call):
    if is_admin(call.from_user.id):
        total_users = len(user_data)
        total_groups = len(group_settings)
        total_codes = len(codes_data)
        
        stats_text = f"""
ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¨ÙˆØª:
ğŸ‘¥ Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†: {total_users}
ğŸ‘¥ Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª: {total_groups}
ğŸ« Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙˆØ¯Ø§Øª: {total_codes}
        """
        
        bot.answer_callback_query(call.id)
        bot.send_message(call.message.chat.id, stats_text)
    else:
        bot.answer_callback_query(call.id, "âŒ Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ©!")

@bot.callback_query_handler(func=lambda call: call.data == "send_notification")
def handle_send_notification(call):
    if is_admin(call.from_user.id):
        msg = bot.send_message(call.message.chat.id, "ğŸ“ Ø£Ø±Ø³Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªÙŠ ØªØ±ÙŠØ¯ Ø¥Ø´Ø¹Ø§Ø± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø¨Ù‡Ø§:")
        bot.register_next_step_handler(msg, process_notification)
    else:
        bot.answer_callback_query(call.id, "âŒ Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ©!")

def process_notification(message):
    if is_admin(message.from_user.id):
        sent = 0
        failed = 0
        
        for chat_id_str in group_settings.keys():
            try:
                chat_id = int(chat_id_str)
                if message.text:
                    bot.send_message(chat_id, f"ğŸ“¢ Ø¥Ø´Ø¹Ø§Ø± Ù…Ù† Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©:\n\n{message.text}")
                elif message.photo:
                    bot.send_photo(chat_id, message.photo[-1].file_id, caption=message.caption or "ğŸ“¢ Ø¥Ø´Ø¹Ø§Ø± Ù…Ù† Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©")
                sent += 1
            except Exception as e:
                failed += 1
                logger.error(f"Error sending notification: {e}")
        
        bot.reply_to(message, f"âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±:\nâœ… Ù†Ø¬Ø­: {sent}\nâŒ ÙØ´Ù„: {failed}")

@bot.callback_query_handler(func=lambda call: call.data == "manage_groups")
def handle_manage_groups(call):
    if is_admin(call.from_user.id):
        groups_text = "ğŸ‘¥ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ø§Ù„Ø¨ÙˆØª:\n\n"
        
        for i, (chat_id_str, settings) in enumerate(list(group_settings.items())[:10], 1):
            try:
                chat = bot.get_chat(int(chat_id_str))
                groups_text += f"{i}. {chat.title} (ID: {chat_id_str})\n"
            except:
                groups_text += f"{i}. Ù…Ø¬Ù…ÙˆØ¹Ø© ØºÙŠØ± Ù…ØªØ§Ø­Ø© (ID: {chat_id_str})\n"
        
        if len(group_settings) > 10:
            groups_text += f"\n+ {len(group_settings) - 10} Ù…Ø¬Ù…ÙˆØ¹Ø© Ø£Ø®Ø±Ù‰..."
        
        bot.answer_callback_query(call.id)
        bot.send_message(call.message.chat.id, groups_text)
    else:
        bot.answer_callback_query(call.id, "âŒ Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ©!")

# --- Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ ---
@bot.message_handler(content_types=['pinned_message', 'forward_from', 'forward_from_chat'])
def handle_forwarded_messages(message):
    if not is_group_chat(message.chat.id):
        return
        
    chat_id_str = str(message.chat.id)
    if chat_id_str not in group_settings:
        return
        
    # Ø§Ù„Ø³Ù…Ø§Ø­ Ù„Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠÙ† ÙˆØ§Ù„Ù…Ø´Ø±ÙÙŠÙ† Ø¨Ø¥Ø±Ø³Ø§Ù„ Ø£ÙŠ Ù…Ø­ØªÙˆÙ‰
    if can_manage_users(message.chat.id, message.from_user.id):
        return
        
    settings = group_settings[chat_id_str]
    
    # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ù…Ù‚ÙÙˆÙ„Ø©
    if settings.get('forwards', False):
        try:
            bot.delete_message(message.chat.id, message.message_id)
            warning_msg = bot.send_message(message.chat.id, f"âš ï¸ {message.from_user.first_name}ØŒ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ù…Ù‚ÙÙ„Ø© Ø­Ø§Ù„ÙŠØ§Ù‹!")
            time.sleep(3)
            bot.delete_message(message.chat.id, warning_msg.message_id)
        except:
            pass

# --- Ø­ÙØ¸ ØµÙˆØ±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ù†Ø¯ Ø·Ù„Ø¨ Ø§Ù„Ø§ÙŠØ¯ÙŠ ---
@bot.message_handler(func=lambda m: m.text in ['Ø§ÙŠØ¯ÙŠ', 'id', 'Ø§Ù„Ø§ÙŠØ¯ÙŠ'] and m.reply_to_message)
def save_user_photo_on_id_request(message):
    target = message.reply_to_message.from_user
    
    try:
        # Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØµÙˆØ±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        user_profile = bot.get_chat(target.id)
        
        if user_profile.photo:
            # Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø£ÙƒØ¨Ø± Ø­Ø¬Ù… Ù„Ù„ØµÙˆØ±Ø©
            file_info = bot.get_file(user_profile.photo.big_file_id)
            photo_url = f"https://api.telegram.org/file/bot{BOT_TOKEN}/{file_info.file_path}"
            
            # Ø­ÙØ¸ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØµÙˆØ±Ø©
            save_user_photo(target.id, user_profile.photo.big_file_id, photo_url)
    except Exception as e:
        logger.error(f"Error saving user photo: {e}")

# --- Ø£Ù…Ø± ØªØºÙŠÙŠØ± Ø§Ù„ØµÙˆØ±Ø© ---
@bot.message_handler(func=lambda m: m.text == 'ØªØºÙŠÙŠØ± Ø§Ù„ØµÙˆØ±Ø©' and m.reply_to_message)
def change_photo_command(message):
    target = message.reply_to_message.from_user
    
    try:
        # Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØµÙˆØ±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        user_profile = bot.get_chat(target.id)
        
        if user_profile.photo:
            # Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø£ÙƒØ¨Ø± Ø­Ø¬Ù… Ù„Ù„ØµÙˆØ±Ø©
            file_info = bot.get_file(user_profile.photo.big_file_id)
            photo_url = f"https://api.telegram.org/file/bot{BOT_TOKEN}/{file_info.file_path}"
            
            # Ø­ÙØ¸ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØµÙˆØ±Ø©
            save_user_photo(target.id, user_profile.photo.big_file_id, photo_url)
            bot.reply_to(message, "âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« ØµÙˆØ±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…!")
        else:
            bot.reply_to(message, "âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØµÙˆØ±Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…!")
    except Exception as e:
        logger.error(f"Error changing user photo: {e}")
        bot.reply_to(message, "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙˆØ±Ø©!")

# --- ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨ÙˆØª ---
import time

def start_bot():
    while True:
        try:
            print("âœ… Ø¨Ø¯Ø£ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨ÙˆØª...")
            bot.infinity_polling(timeout=60, long_polling_timeout=60)
        except Exception as e:
            print(f"âŒ Ø­Ø¯Ø« Ø®Ø·Ø£: {e}")
            print("ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨ÙˆØª Ø®Ù„Ø§Ù„ 10 Ø«ÙˆØ§Ù†ÙŠ...")
            time.sleep(10)

if __name__ == "__main__":
    print("âœ… ØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨ÙˆØª Ø¨Ù†Ø¬Ø§Ø­!")
    get_developer_photo()
    start_bot()
    
    # ØªØ­Ø¯ÙŠØ« ØµÙˆØ±Ø© Ø§Ù„Ù…Ø·ÙˆØ± Ø¹Ù†Ø¯ Ø§Ù„Ø¨Ø¯Ø¡
    get_developer_photo()
    
    bot.infinity_polling()
